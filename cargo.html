<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Elite Air Cargo — Book & Track</title>
<link rel="icon" type="image/x-icon" href="img/elite.ico">
<meta name="description" content="Book, track, and get rate estimates for Elite Air Cargo. Kuwait-locked routes; premium, reliable service."/>
<style>
/* ===== Receipt modal + print ===== */
.rcpt-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.46);z-index:99999;padding:16px}
.rcpt-overlay.show{display:flex}
.rcpt{width:min(880px,96vw);max-height:92vh;overflow:auto;background:#fff;border-radius:14px;border:1px solid #e5e7eb;box-shadow:0 24px 80px rgba(0,0,0,.3)}
.rcpt header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid #e5e7eb}
.rcpt .sheet{padding:16px}
.rcpt .brand{font-weight:900;letter-spacing:.06em}
.rcpt .actions{display:flex;gap:8px}
.rcpt .btn{padding:8px 14px;border-radius:999px;border:1px solid var(--ea-gold);background:#fff;font-weight:800;cursor:pointer}
.rcpt .btn.primary{background:var(--ea-gold);color:#111}
.rcpt .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.rcpt h3{margin:6px 0 10px}
.rcpt table{width:100%;border-collapse:collapse;margin-top:6px}
.rcpt th, .rcpt td{padding:8px 10px;border-top:1px solid #e5e7eb;font-size:14px;text-align:left}
.rcpt .muted{color:#6b7280;font-size:12px}
.rcpt .totals{display:grid;grid-template-columns:1fr auto;gap:8px;margin-top:10px}
@media print{
  /* 1) page par sirf receipt dikhani hai */
  body *{ display:none !important; }

  /* 2) receipt ko normal flow me lao (fixed na ho), taaki repeat na ho */
  #receiptModal{
    display:block !important;
    position:static !important;   /* was fixed -> repeat hota tha */
    inset:auto !important;
    background:#fff !important;
    padding:0 !important;
    box-shadow:none !important;
  }
  #receiptModal .rcpt{
    display:block !important;
    width:auto !important;
    max-height:none !important;
    border:none !important;
    box-shadow:none !important;
  }
  #receiptModal header .actions{ display:none !important; } /* Print/Close buttons hide in print */

  /* 3) receipt content visible & proper table layout */
  #receiptModal *{ display:initial !important; visibility:visible !important; }
  #receiptModal table{ display:table !important; width:100% !important; }
  #receiptModal thead{ display:table-header-group !important; }
  #receiptModal tbody{ display:table-row-group !important; }
  #receiptModal tr{ display:table-row !important; }
  #receiptModal th, #receiptModal td{ display:table-cell !important; }

  /* optional: page margins */
  @page{ margin:12mm; }

}
</style>

<style>
  /* ---------- Tokens ---------- */
  :root{
    --ea-charcoal:#161A1F; --ea-gold:#C7A98C; --ea-gold-hi:#FFD479; --ea-pearl:#FDFDFC;
    --ea-text-sub:#B9C1CC; --ea-navy:#0f172a; --ea-ink:#111827; --ea-ivory:#f7f4ee;
    --ea-panel:#ffffff; --ea-muted:#6b7280; --ea-line:#e5e7eb; --nav-h:72px;
    /* extra (legacy) */
    --ea-accent:#c9b89a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
    color:var(--ea-ink); background:#fff; line-height:1.55;
    padding-top: calc(var(--nav-h) + 18px);
  }
  .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  .container{ max-width:1200px; margin:0 auto; padding:0 16px; }
  .card{ background:#fff; border:1px solid var(--ea-line); border-radius:14px; box-shadow:0 14px 30px rgba(15,23,42,.06); }
  .pill{ border-radius:999px; }

  /* =========================
     FIXED Header (from Home)
     ========================= */
  .nav{
    position:fixed; top:0; left:0; right:0; z-index:10000;
    display:flex; align-items:center; gap:5px;
    padding:26px 56px;
    background:linear-gradient(90deg,#D5D7DB 0%,#C7A98C 44%,#F7F6F3 78%,#FDFDFC 100%);
    box-shadow:0 6px 24px rgba(0,0,0,.06), inset 0 -3px 0 rgba(184,146,106,.45);
    border:none;
  }
  .logo{ font-family:"Playfair Display",serif; font-size:28px; font-weight:600; color:#1e1e1e; letter-spacing:.06em; }
  .nav-group{ display:flex; align-items:center; gap:6px; margin-left:auto; }
  .nav a{
    margin:0 18px; text-decoration:none; color:#222; font-weight:600; font-size:15px; letter-spacing:.03em; position:relative;
  }
  .nav a::after{
    content:""; position:absolute; left:0; right:0; bottom:-10px; height:2px;
    background:linear-gradient(90deg,#C7A98C,#E7D9C7); opacity:0; transform:scaleX(.6); transition:opacity .2s, transform .2s;
  }
  .nav a:hover{ color:#c7a98c; } .nav a:hover::after{ opacity:1; transform:scaleX(1); }
  .btn-book{
    padding:12px 24px; border-radius:999px; border:1px solid var(--ea-gold);
    background:rgba(255,255,255,.35); font-weight:700; cursor:pointer; transition:all .25s; color:#1e1e1e; box-shadow:0 4px 14px rgba(0,0,0,.05);
  }
  .btn-book:hover{ background:var(--ea-gold); color:#fff; box-shadow:0 10px 22px rgba(199,169,140,.35); }

  /* Hamburger + mobile panel */
  .hamburger{ display:none; border:0; background:transparent; padding:8px; margin-right:4px; border-radius:10px; }
  .hamburger:focus{ outline:2px solid #c7a98c; outline-offset:2px; }
  .ham-bars{ display:inline-grid; gap:5px; }
  .ham-bars span{ display:block; width:22px; height:2px; background:#1e1e1e; border-radius:2px; transition:transform .25s, opacity .25s; }
  .nav-panel{ display:none; position:fixed; top:var(--nav-h); left:0; right:0; background:#fff; box-shadow:0 22px 60px rgba(0,0,0,.16); z-index:9999; padding:12px 14px 16px; border-bottom:1px solid #eee; }
  .nav-panel a{ display:block; margin:10px 6px; font-weight:700; color:#222; text-decoration:none; }
  .nav-panel .row-actions{ display:grid; gap:10px; margin-top:6px; }
  .nav-backdrop{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.28); z-index:9998; }
  .nav.open .nav-panel{ display:block; animation:slideDown .18s ease-out; }
  .nav.open + .nav-backdrop{ display:block; }
  .nav.open .ham-bars span:nth-child(1){ transform:translateY(7px) rotate(45deg); }
  .nav.open .ham-bars span:nth-child(2){ opacity:0; }
  .nav.open .ham-bars span:nth-child(3){ transform:translateY(-7px) rotate(-45deg); }
  @keyframes slideDown{ from{ transform:translateY(-8px); opacity:.6 } to{ transform:translateY(0); opacity:1 } }

  @media (max-width:900px){
    :root{ --nav-h:64px }
    body{ padding-top: var(--nav-h); }
    .nav{ padding:10px 14px; }
    .hamburger{ display:inline-flex; margin-left:auto; }
    .nav-group{ display:none; }
  }

  /* Language switcher (same as Home) */
  .ea-actions{ display:flex; align-items:center; gap:14px; margin-left:auto; }
  .lang-switch{ position:relative; }
  .lang-btn{ display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border:1px solid #e6e8ee; border-radius:999px; background:#fff; color:#111; cursor:pointer; font-weight:700; letter-spacing:.04em; }
  .lang-btn .chev{ transition:transform .15s; }
  .lang-switch.open .lang-btn .chev{ transform:rotate(180deg); }
  .lang-list{ position:absolute; right:0; top:calc(100% + 8px); background:#fff; border:1px solid #e6e8ee; border-radius:12px; box-shadow:0 12px 26px rgba(0,0,0,.08); padding:6px; list-style:none; margin:0; display:none; min-width:92px; z-index:50; }
  .lang-switch.open .lang-list{ display:block; }
  .lang-list li{ padding:8px 10px; border-radius:10px; cursor:pointer; font-weight:700; }
  .lang-list li:hover{ background:#f4f5f7; }

  /* =========================
     Buttons — index style
     ========================= */
  .btn, .ea-btn{
    padding:12px 24px; border-radius:999px; border:1px solid var(--ea-gold);
    background:rgba(255,255,255,.35); font-weight:700; cursor:pointer; transition:all .25s; color:#1e1e1e;
    box-shadow:0 4px 14px rgba(0,0,0,.05); text-decoration:none; display:inline-flex; align-items:center; justify-content:center; gap:8px;
  }
  .btn:hover, .ea-btn:hover{ background:var(--ea-gold); color:#fff; box-shadow:0 10px 22px rgba(199,169,140,.35); }
  .btn.secondary{ background:#fff; border:1px solid var(--ea-line); }
  .btn.secondary:hover{ border-color:var(--ea-gold); }

  /* =========================
     Cargo page styles
     ========================= */
  .eyebrow{ text-transform:uppercase; letter-spacing:.08em; font-size:12px; color:#6b7280; font-weight:700; }
  .cargo-hero{ background:#fff; }
  .cargo-hero .wrap{ display:grid; grid-template-columns:1.05fr .95fr; gap: clamp(18px,4vw,42px); padding: clamp(20px,4.5vw,48px) 16px; align-items:center; }
  .cargo-hero h1{ font-weight:900; font-size: clamp(28px,3.2vw,44px); line-height:1.12; margin:0 0 10px; color:var(--ea-ink); }
  .cargo-hero p{ margin:0; color:#4b5563; line-height:1.85; max-width:60ch; }
  .cargo-badge{ display:inline-flex; align-items:center; gap:8px; margin:12px 0 0; font-weight:800; font-size:12px; padding:8px 12px; background:var(--ea-gold); border-radius:999px; color:#111; }
  .cargo-art{ border-radius:18px; overflow:hidden;}
  .cargo-art svg{ width:100%; height:auto; display:block; }
  .cargo-art img{ width:350px; height:350px; display:block; border-radius: 20px;}
  .cargo-title{ color:#000000; text-shadow:0 8px 26px rgba(0,0,0,.35); font-size:clamp(32px,5vw,56px); line-height:1.04; margin:12px 0 8px; }

  .booking{ margin: 10px auto clamp(24px,4vw,48px); }
  .booking .tabs{ display:grid; grid-template-columns: repeat(3,1fr); border:1px solid var(--ea-line); border-radius:16px; overflow:hidden; }
  .booking .tab{ padding:12px; font-weight:800; background:#f9fafb; border:none; cursor:pointer; }
  .booking .tab[aria-selected="true"]{ background:#fff; color:#111; box-shadow:inset 0 -3px 0 var(--ea-gold); }
  .panel{ border:1px solid var(--ea-line); border-top:none; border-radius:0 0 16px 16px; padding:16px; }

  .grid{ display:grid; gap:14px; }
  .grid.cols-2{ grid-template-columns: 1fr 1fr; }
  .grid.cols-3{ grid-template-columns: repeat(3,1fr); }
  .grid.cols-4{ grid-template-columns: repeat(4,1fr); }
  .grid.cols-6{ grid-template-columns: repeat(6,1fr); }
  @media (max-width:1024px){ .grid.cols-6{ grid-template-columns: 1fr 1fr 1fr; } }
  @media (max-width:720px){ .grid.cols-6,.grid.cols-4,.grid.cols-3,.grid.cols-2{ grid-template-columns: 1fr; } }

  label.field{ display:grid; gap:6px; font-size:12px; color:#374151; }
  .field input, .field select, .field textarea{ width:100%; padding:10px 12px; border:1px solid var(--ea-line); border-radius:10px; background:#fff; font-size:14px; }
  .field textarea{ min-height:96px; resize:vertical; }
  .note{ font-size:12px; color:#6b7280; margin:4px 0 0; }

  .chipset{ display:flex; gap:8px; flex-wrap:wrap; }
  .chip{ padding:8px 12px; border:1px solid var(--ea-line); background:#f3f4f6; border-radius:999px; cursor:pointer; font-weight:700; }
  .chip.is-active{ background:var(--ea-gold); color:#111; border-color:transparent; }

  .units{ display:flex; align-items:center; gap:8px; }
  .units .switch{ display:inline-flex; gap:6px; align-items:center; padding:6px 10px; border:1px solid var(--ea-line); border-radius:999px; background:#fff; }
  .units input{ accent-color: var(--ea-gold); }

  .pieces{ display:grid; gap:10px; }
  .piece{ display:grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap:8px; align-items:end; }
  .piece .kill{ border:none; background:#fee2e2; color:#991b1b; font-weight:800; padding:10px 8px; border-radius:10px; cursor:pointer; }
  .adder{ justify-self:start; padding:10px 14px; border:none; background:#f3f4f6; border:1px solid var(--ea-line); font-weight:800; border-radius:10px; cursor:pointer; }
  .calc{ background:#fff; border:1px solid var(--ea-line); border-radius:16px; padding:12px; display:grid; gap:8px; }

  .cta-row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

  .layout{ display:grid; grid-template-columns: minmax(0,1.2fr) .8fr; gap:18px; align-items:start; }
  @media (max-width:1024px){ .layout{ grid-template-columns: 1fr; } }
  .summary{ position:sticky; top:72px; padding:14px; }
  .summary h4{ margin:0 0 8px; font-size:16px; }
  .summary .row{ display:flex; justify-content:space-between; gap:12px; font-size:14px; }
  .summary .row strong{ font-weight:800; }
  .summary .muted{ color:#6b7280; font-size:12px; }

  .section{ padding: clamp(20px,4vw,48px) 0; }
  .title{ font-weight:900; font-size: clamp(20px,2.2vw,28px); margin:0 0 10px; }
  .sub{ color:#4b5563; margin:0 0 18px; }

  .ship-grid{ display:grid; grid-template-columns: repeat(4,1fr); gap:14px; }
  @media (max-width:980px){ .ship-grid{ grid-template-columns: 1fr 1fr; } }
  @media (max-width:600px){ .ship-grid{ grid-template-columns: 1fr; } }
  .ship-card{ padding:12px; display:grid; gap:8px; }
  .ship-card h4{ margin:0; font-size:16px; font-weight:800; }

  /* =========================
     Mesh Footer (from Home)
     ========================= */
  .elite-footer{ position:relative; background:linear-gradient(180deg,#1C2128,var(--ea-charcoal)); color:var(--ea-pearl); padding:64px 40px 36px; overflow:hidden; -webkit-font-smoothing:antialiased; }
  .elite-mesh{ position:absolute; inset:-10% -6% -18% -6%; transform:rotate(-6deg); width:120%; height:140%; pointer-events:none; }
  .elite-footer__inner{ position:relative; z-index:1; display:grid; gap:12px; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); }
  .elite-col h4{ margin:0 0 14px; font:600 14px/1.3 "Inter",system-ui; letter-spacing:.08em; text-transform:uppercase; color:var(--ea-pearl); }
  .elite-col a{ display:block; margin:8px 0; color:var(--ea-text-sub); text-decoration:none; font:500 14px/1.6 "Inter",system-ui; transition:color .2s ease; }
  .elite-col a:hover{ color:var(--ea-gold-hi); }
  .elite-copy{ position:relative; z-index:1; margin:42px 0 0; padding-top:18px; border-top:1px solid rgba(255,255,255,.14); color:#9FA6B2; font:400 14px/1.6 "Inter",system-ui; text-align:center; }
  .ea-breadcrumb{ font-size:14px; color:#6b7280; margin-bottom:18px; display:flex; gap:8px; align-items:center; }
  .ea-breadcrumb .crumb{ text-decoration:none; color:#6b7280; }
  .ea-breadcrumb .current{ color:#111827; }
</style>
</head>

<body>

<!-- ===== Fixed Gradient Header (Home-style) ===== -->
<nav class="nav" aria-label="Primary">
  <div class="logo">ELITE&nbsp;AIR</div>

  <!-- Mobile hamburger -->
  <button class="hamburger" id="nav-toggle" aria-expanded="false" aria-controls="nav-panel" aria-label="Open menu">
    <span class="ham-bars" aria-hidden="true"><span></span><span></span><span></span></span>
  </button>

  <!-- Desktop links -->
  <div class="nav-group" id="nav-group">
    <a href="index.html" data-i18n="nav.home">Home</a>
    <a href="destinations.html" data-i18n="nav.destinations">Destinations</a>
    <a href="offers.html" data-i18n="nav.offers">Offers</a>
    <a href="experience.html" data-i18n="nav.experience">Experience</a>
    <a href="news.html" data-i18n="nav.news">Latest news</a>
    <a href="cargo.html" data-i18n="nav.cargo">Cargo</a>
    <a href="membership.html" data-i18n="nav.membership">Membership</a>
    <div class="spacer"></div>
    <button class="btn-book" type="button" onclick="location.href='members'" data-i18n="cta.login">Members Login</button>

    <!-- Language switcher -->
    <div class="ea-actions">
      <div class="lang-switch" id="lang-switch">
        <button class="lang-btn" id="lang-btn" aria-haspopup="listbox" aria-expanded="false">
          <span id="lang-current">EN</span>
          <svg class="chev" width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
        <ul class="lang-list" id="lang-list" role="listbox" aria-label="Choose language">
          <li role="option" data-lang="en">EN</li>
          <li role="option" data-lang="ar">AR</li>
          <li role="option" data-lang="fr">FR</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Mobile dropdown panel -->
  <div class="nav-panel" id="nav-panel" hidden>
    <a href="index.html" data-i18n="nav.home">Home</a>
    <a href="destinations.html" data-i18n="nav.destinations">Destinations</a>
    <a href="offers.html" data-i18n="nav.offers">Offers</a>
    <a href="experience.html" data-i18n="nav.experience">Experience</a>
    <a href="news.html" data-i18n="nav.news">Latest news</a>
    <a href="cargo.html" data-i18n="nav.cargo">Cargo</a>
    <a href="membership.html" data-i18n="nav.membership">Membership</a>
    <div class="row-actions">
      <button class="btn-book" type="button" onclick="location.href='members'">Members Login</button>
      <div class="ea-actions" id="lang-mobile-slot"></div>
    </div>
  </div>
</nav>
<div class="nav-backdrop" id="nav-backdrop" hidden></div>

<!-- ===== Cargo Hero ===== -->
<section class="cargo-hero" role="region" aria-labelledby="cargoTitle">
  <div class="container wrap">
    <div>
      <nav class="ea-breadcrumb" aria-label="Breadcrumb">
      <a href="/" class="crumb">Home</a>
      <span aria-hidden="true">/</span>
      <span class="crumb current">Cargo</span>
    </nav>
      <h1 class="cargo-title">Book, track and ship always via Kuwait</h1>
      <p>
        Move your freight with precision and care. Elite Air Cargo offers point-to-point shipments that
        <strong>always start or end in Kuwait</strong>. Get an instant chargeable weight estimate, request a quote,
        and track your shipment  all in one place.
      </p>
      <div class="cargo-badge" aria-label="Service highlights">
        <span>All-luxury A321 lower deck • Priority handling • Kuwait hub</span>
      </div>
    </div>
    <figure class="cargo-art" aria-label="Aircraft nose with cargo loader">
      <img src="img/eliteair-cargo.jpeg" alt="Elite Air aircraft over turquoise islands"/>
    </figure>
  </div>
</section>

<!-- ===== Booking / Track / Rates ===== -->
<section class="booking container" role="region" aria-labelledby="bookTabs">
  <h2 id="bookTabs" class="sr-only">Cargo booking and tracking</h2>

  <div class="tabs" role="tablist" aria-label="Cargo">
    <button class="tab" id="tab-book" role="tab" aria-controls="panel-book" aria-selected="true">Book shipment</button>
    <button class="tab" id="tab-track" role="tab" aria-controls="panel-track" aria-selected="false">Track</button>
    <button class="tab" id="tab-rates" role="tab" aria-controls="panel-rates" aria-selected="false">Rates</button>
  </div>

  <div id="panel-book" class="panel" role="tabpanel" aria-labelledby="tab-book">
    <div class="layout">
      <!-- Left: form -->
      <form id="cargoForm" class="grid" novalidate>
        <div class="chipset" role="group" aria-label="Direction">
          <button type="button" class="chip is-active" data-direction="export" aria-pressed="true">Export from Kuwait</button>
          <button type="button" class="chip" data-direction="import" aria-pressed="false">Import to Kuwait</button>
        </div>

        <div class="units" aria-label="Measurement units">
          <span class="eyebrow">Units</span>
          <label class="switch"><input type="radio" name="units" value="metric" checked> kg / cm</label>
          <label class="switch"><input type="radio" name="units" value="imperial"> lb / in</label>
        </div>

        <div class="grid cols-2">
          <label class="field">From
            <select id="fromCity" required aria-required="true"></select>
          </label>
          <label class="field">To
            <select id="toCity" required aria-required="true"></select>
          </label>
        </div>
        <p class="note">Elite Air cargo lanes always include Kuwait. Choosing a non-Kuwait city will auto-lock the other side to Kuwait.</p>

        <div class="grid cols-3">
          <label class="field">Service
            <select id="service">
              <option value="priority">Priority</option>
              <option value="express">Express</option>
              <option value="economy">Economy</option>
            </select>
          </label>
          <label class="field">Ready date
            <input type="date" id="readyDate" />
          </label>
          <label class="field">Preferred flight (optional)
            <input type="text" id="prefFlight" placeholder="EA321 / date" />
          </label>
        </div>

        <div class="grid cols-3">
          <label class="field">Commodity
            <select id="commodity">
              <option value="general">General cargo</option>
              <option value="perishable">Perishable</option>
              <option value="pharma">Pharma / temperature-controlled</option>
              <option value="valuables">Valuables</option>
              <option value="live-animals">Live animals (on request)</option>
              <option value="dangerous">Dangerous goods (on request)</option>
            </select>
          </label>
          <label class="field">Temperature (°C, optional)
            <input type="text" id="temp" placeholder="e.g., +2 to +8" />
          </label>
          <label class="field">Declared value (KWD, optional)
            <input type="number" id="declared" min="0" step="0.01" placeholder="0.00" />
          </label>
        </div>

        <div class="chipset" role="group" aria-label="Dangerous goods">
          <span class="eyebrow">Dangerous goods</span>
          <button type="button" class="chip" data-dg="no" aria-pressed="false">No</button>
          <button type="button" class="chip" data-dg="yes" aria-pressed="false">Yes</button>
        </div>
        <div id="dgExtra" class="grid cols-3" style="display:none">
          <label class="field">UN number <input type="text" id="unNumber" placeholder="e.g., UN1845"/></label>
          <label class="field">Class / Division <input type="text" id="dgClass" placeholder="e.g., 3 / 8" /></label>
          <label class="field">Packing group <input type="text" id="pg" placeholder="I / II / III" /></label>
        </div>
        <p class="note">Dangerous goods, live animals, and valuables are subject to acceptance and specific regulations. Provide full details for approval.</p>

        <div class="pieces card" aria-label="Pieces">
          <div class="calc">
            <div class="eyebrow">Pieces</div>
            <div class="piece" data-idx="1">
              <label class="field">Length <input type="number" min="0" step="0.1" class="len" placeholder="L" required></label>
              <label class="field">Width <input type="number" min="0" step="0.1" class="wid" placeholder="W" required></label>
              <label class="field">Height <input type="number" min="0" step="0.1" class="hei" placeholder="H" required></label>
              <label class="field">Weight <input type="number" min="0" step="0.1" class="wei" placeholder="kg" required></label>
              <label class="field">Qty <input type="number" min="1" step="1" class="qty" value="1" required></label>
              <button type="button" class="kill" aria-label="Remove piece" title="Remove piece">Remove</button>
            </div>
            <button type="button" class="adder" id="addPiece">+ Add another piece</button>
            <p class="note" id="unitNote">Dimensions in <strong>cm</strong>, weight in <strong>kg</strong>. Volumetric divisor: <strong>6000</strong> (air).</p>
          </div>
        </div>

        <div class="grid cols-2">
          <label class="field">Shipper name
            <input type="text" id="shipper" placeholder="Company / Contact" required>
          </label>
          <label class="field">Consignee name
            <input type="text" id="consignee" placeholder="Company / Contact" required>
          </label>
        </div>
        <div class="grid cols-3">
          <label class="field">Email <input type="email" id="email" placeholder="name@company.com" required></label>
          <label class="field">Phone <input type="tel" id="phone" placeholder="+965 xxx xxx xx" required></label>
          <label class="field">Notes (optional) <input type="text" id="notes" placeholder="Handling / pickup / delivery"/></label>
        </div>

        <div class="cta-row">
          <button type="button" id="getQuote" class="btn">Get quote (estimate)</button>
          <button type="submit" class="btn secondary">Send booking request</button>
          <span class="note">Estimates are for guidance only. Final charges subject to acceptance, screening, and actual weight/volume.</span>
        </div>
      </form>

      <!-- Right: summary -->
      <aside class="summary card" aria-label="Quote summary">
        <h4>Quote summary</h4>
        <div class="row"><span>Chargeable weight</span><strong id="sumCw">—</strong></div>
        <div class="row"><span>Service</span><strong id="sumSvc">—</strong></div>
        <div class="row"><span>Lane</span><strong id="sumLane">—</strong></div>
        <div class="row"><span>Est. price</span><strong id="sumPrice">—</strong></div>
        <p class="muted">DEMO_RATES in use. Replace with live tariffs in <code>rateTable</code> (see script).</p>
      </aside>
    </div>
  </div>

  <!-- Track -->
  <div id="panel-track" class="panel" role="tabpanel" aria-labelledby="tab-track" hidden>
    <form id="trackForm" class="grid cols-3" novalidate>
      <label class="field">Air Waybill (AWB) or Reference
        <input type="text" id="awb" placeholder="e.g., 123-45678901" required />
      </label>
      <label class="field">Shipper or Consignee
        <input type="text" id="who" placeholder="Name (optional)"/>
      </label>
      <div class="cta-row">
        <button type="submit" class="btn">Track</button>
        <span class="note">Example client-side stub. Wire to your tracking endpoint.</span>
      </div>
    </form>
    <div id="trackResult" class="card" style="display:none; padding:12px; margin-top:12px"></div>
  </div>

  <!-- Rates -->
  <div id="panel-rates" class="panel" role="tabpanel" aria-labelledby="tab-rates" hidden>
    <div class="grid cols-2">
      <div class="card" style="padding:12px">
        <h3 class="title">How we estimate</h3>
        <p class="sub">
          Air freight charges typically use the higher of actual gross weight or volumetric weight.
          For air, we use a divisor of <strong>6000</strong> (when using cm and kg). Example: (L×W×H in cm ÷ 6000) × pieces.
        </p>
        <ul>
          <li><strong>Chargeable weight</strong> = max(gross, volumetric)</li>
          <li>Fuel / security / screening surcharges may apply</li>
          <li>Airport fees, pickup, and delivery not included in demo</li>
        </ul>
      </div>
      <div class="card" style="padding:12px">
        <h3 class="title">Popular lanes</h3>
        <p class="sub">All cargo moves include Kuwait. Ask us if your city isn’t listed yet.</p>
        <ul>
          <li>Kuwait ⇄ London</li>
          <li>Kuwait ⇄ Paris</li>
          <li>Kuwait ⇄ Dubai</li>
          <li>Kuwait ⇄ Riyadh</li>
          <li>Kuwait ⇄ Doha</li>
          <li>Kuwait ⇄ Istanbul</li>
          <li>Kuwait ⇄ Cairo</li>
          <li>Kuwait ⇄ Casablanca</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- ===== What we ship ===== -->
<section class="section" aria-labelledby="whatShip">
  <div class="container">
    <h3 id="whatShip" class="title">What we ship</h3>
    <p class="sub">From general cargo to temperature-controlled shipments, we handle it with care and clarity.</p>
    <div class="ship-grid">
      <article class="ship-card card">
        <figure aria-label="Boxes">
          <img src="img/eliteair-cargo10.png" alt="Elite Air Genral Cargo" style="width:250px;height:200px;object-fit:cover;border-radius: 20px"/>
        </figure>
        <h4>General cargo</h4>
        <p>Cartons, pallets, and crates screened and secured for smooth uplift.</p>
      </article>
      <article class="ship-card card">
        <figure aria-label="Thermometer">
          <img src="img/eliteair-cargo3.jpeg" alt="Elite Air Pharma Cargo" style="width:250px;height:200px;object-fit:cover;border-radius: 20px"/>
        </figure>
        <h4>Pharma / Perishables</h4>
        <p>Tempture controlled handling with clear SOPs and time critical options.</p>
      </article>
      <article class="ship-card card">
        <figure aria-label="Hazard label">
        <img src="img/elite-cargo-special.png" alt="Elite Air Special Cargo" style="width:250px;height:200px;object-fit:cover; border-radius: 20px"/>
        </figure>
        <h4>Specials</h4>
        <p>Dangerous goods and live animals on request and subject to approval.</p>
      </article>
    </div>
  </div>
</section>

<!-- ===== Mesh Footer (Home-style) ===== -->
<footer class="elite-footer">
  <svg class="elite-mesh" viewBox="0 0 1600 900" preserveAspectRatio="none" aria-hidden="true">
    <defs>
      <linearGradient id="eaGold" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="#C7A98C"/><stop offset="1" stop-color="#FFD479"/>
      </linearGradient>
    </defs>
    <g stroke="url(#eaGold)" stroke-width="2.6" stroke-linecap="round" opacity="0.55">
      <path d="M-120,840 C 220,690 560,640 980,620 1310,605 1670,560 1880,490"/>
      <path d="M-120,760 C 220,620 560,580 980,560 1310,545 1670,510 1880,450"/>
      <path d="M-120,680 C 220,550 560,520 980,500 1310,490 1670,470 1880,415"/>
      <path d="M-120,600 C 220,480 560,460 980,440 1310,430 1670,440 1880,385"/>
      <path d="M-120,520 C 220,420 560,400 980,380 1310,370 1670,410 1880,360"/>
    </g>
    <g stroke="url(#eaGold)" stroke-width="2.6" stroke-linecap="round" opacity="0.55">
      <path d="M 0,900 C 360,760 720,700 1120,660 1520,620 1920,560 2320,520"/>
      <path d="M 0,820 C 360,700 720,640 1120,600 1520,560 1920,540 2320,500"/>
      <path d="M 0,740 C 360,640 720,600 1120,560 1520,520 1920,520 2320,480"/>
      <path d="M 0,660 C 360,580 720,560 1120,520 1520,500 1920,500 2320,460"/>
    </g>
  </svg>

  <div class="elite-footer__inner">
    <div class="elite-col">
      <h4>Popular flights</h4>
      <a href="#">Kuwait → London</a>
      <a href="#">Kuwait → Paris</a>
      <a href="#">Kuwait → Dubai</a>
      <a href="#">Kuwait → Cairo</a>
      <a href="#">Kuwait → Istanbul</a>
      <a href="#">Kuwait → Marrakesh</a>
      <a href="#">Kuwait → Riyadh</a>
      <a href="#">Kuwait → Doha</a>
    </div>

    <div class="elite-col">
      <h4>Navigation</h4>
      <a href="index.html" data-i18n="nav.home">Home</a>
      <a href="destinations.html" data-i18n="nav.destinations">Destinations</a>
      <a href="offers.html" data-i18n="nav.offers">Offers</a>
      <a href="experience.html" data-i18n="nav.experience">Experience</a>
      <a href="news.html" data-i18n="nav.news">Latest News</a>
      <a href="cargo.html" data-i18n="nav.cargo">Cargo</a>
      <a href="membership.html" data-i18n="nav.membership">Membership</a>
    </div>

    <div class="elite-col">
      <h4>About us</h4>
      <a href="why-elite-air.html">Why Elite Air</a>
      <a href="careers.html">Careers</a>
      <a href="contact.html">Contact</a>
      <a href="imprint.html">Imprint</a>
      <a href="meda.html">Medical Assistance</a>
      <a href="investor/investors-index.html">Investors</a>
    </div>

    <div class="elite-col">
      <h4>Policies</h4>
      <a href="privacy-policy.html">Privacy Policy</a>
      <a href="Cookie-Policy.html">Cookie Policy</a>
      <a href="membership-terms.html">Membership Terms</a>
    </div>

    <div class="elite-col">
      <h4>Legal</h4>
      <a href="Terms-And-Conditions.html">Terms & Conditions</a>
      <a href="Conditions-of-Carriage.html">Conditions of Carriage</a>
      <a href="Notice-of-Passenger-Rights.html">Notice of Passenger Rights</a>
    </div>
  </div>

  <p class="elite-copy">© 2025 Elite Airline Company K.S.C. (Public). All Rights Reserved.</p>
</footer>
<script>
  // ---- Receipt helpers ----
function rcptRow(label, val){ return `<tr><th style="width:180px">${label}</th><td>${val??'—'}</td></tr>`; }
function asKWD(n){ return (+(n||0)).toFixed(2)+' KWD'; }

function buildPiecesTable(pieces){
  if(!Array.isArray(pieces)||pieces.length===0) return '';
  const rows = pieces.map((p,i)=>`
    <tr>
      <td>${i+1}</td>
      <td>${(p.Q||p.qty||1)}</td>
      <td>${(p.Lcm??p.L)||0}</td>
      <td>${(p.Wcm??p.W)||0}</td>
      <td>${(p.Hcm??p.H)||0}</td>
      <td>${((p.Gkg??p.G)||0).toFixed ? (p.Gkg||p.G).toFixed(2) : (p.Gkg||p.G||0)}</td>
      <td>${(((p.Lcm??p.L)||0)*((p.Wcm??p.W)||0)*((p.Hcm??p.H)||0)/6000*(p.Q||1)).toFixed(2)}</td>
    </tr>`).join('');
  return `
    <h3>Pieces</h3>
    <table>
      <thead>
        <tr><th>#</th><th>Qty</th><th>L (cm)</th><th>W (cm)</th><th>H (cm)</th><th>Weight (kg)</th><th>Vol kg</th></tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>`;
}

function showReceipt(data){
  const {
    awb='—', status='Received', ts=new Date(),
    route, service, flightNo, date, rate=0, cw=0, cbm=0, price=0,
    shipper, consignee, email, phone, notes, pieces=[]
  } = data||{};

  const rcpt = `
    <div class="grid-2">
      <div>
        <h3 id="rcptTitle" style="margin:0 0 6px">Receipt</h3>
        <div class="muted">${new Date(ts).toLocaleString()}</div>
      </div>
      <div style="text-align:right">
        <div><strong>AWB:</strong> ${awb}</div>
        <div><strong>Status:</strong> ${status}</div>
      </div>
    </div>

    <h3>Shipment</h3>
    <table>
      ${rcptRow('Route', route)}
      ${rcptRow('Service', (service||'').toUpperCase())}
      ${rcptRow('Flight', `${flightNo||'—'} • ${date||'—'}`)}
      ${rcptRow('Chargeable weight', `${(+cw||0).toFixed(1)} kg`)}
      ${rcptRow('Volume', `${(+cbm||0).toFixed(3)} cbm`)}
      ${rcptRow('Rate', asKWD(+rate||0))}
      ${rcptRow('Estimated Price', asKWD(+price||((+cw||0)*(+rate||0))))}
    </table>

    ${buildPiecesTable(pieces)}

    <h3>Shipper / Consignee</h3>
    <table>
      ${rcptRow('Shipper', shipper)}
      ${rcptRow('Consignee', consignee)}
      ${rcptRow('Email', email)}
      ${rcptRow('Phone', phone)}
      ${rcptRow('Notes', notes||'—')}
    </table>

    <div class="totals">
      <div class="muted">* Final charges subject to acceptance, screening & actuals.</div>
      <div><strong>Total: ${asKWD(+price||((+cw||0)*(+rate||0)))}</strong></div>
    </div>
  `;
  document.getElementById('rcptBody').innerHTML = rcpt;
  document.getElementById('receiptModal').classList.add('show');
}
/* ============================================================
   ELITE AIR CARGO — FULL JS (LIVE, FIXED CW>0)
   - Strict piece validation (L/W/H/Weight must be > 0)
   - Sends unrounded cw to backend (UI still shows rounded)
   - Blocks booking if cw <= 0
   ============================================================ */

(function(){
  "use strict";

  /* ---------- small helpers ---------- */
  const API = (typeof window !== 'undefined' && window.EA_API_BASE) ? window.EA_API_BASE : '/cargo/api';
  const $  = (sel,root=document)=> root.querySelector(sel);
  const $$ = (sel,root=document)=> Array.from(root.querySelectorAll(sel));
  const fmtKWD = v => (+(v||0)).toFixed(2) + ' KWD';
  const byAlpha = (a,b)=> String(a).localeCompare(String(b),'en',{sensitivity:'base'});

  function inputDateISO(el){
    const v = (el?.value||'').trim();
    if(v) return v;
    const d = new Date();
    return new Date(d.getTime()-d.getTimezoneOffset()*60000).toISOString().slice(0,10);
  }
  function trimStr(x){ return (x??'').toString().trim(); }
  function isKuwait(name){ return /kuwait/i.test(name||''); }

  async function apiGet(path, params){
    const base = API.endsWith('/') ? API.slice(0,-1) : API;
    const url = new URL(base + path, location.origin);
    if(params){ Object.entries(params).forEach(([k,v])=> url.searchParams.set(k, v)); }
    const r = await fetch(url.toString(), { headers:{'Accept':'application/json'} });
    if(!r.ok){
      const t = await r.text().catch(()=> '');
      throw new Error(`HTTP ${r.status} ${r.statusText} @ ${url.pathname}\n${t.slice(0,200)}`);
    }
    let j; try{ j = await r.json(); }catch{ j = {}; }
    if(j && j.ok===false) throw new Error(j.error||'API error');
    return j.data ?? j;
  }
  async function apiPost(path, body){
    const base = API.endsWith('/') ? API.slice(0,-1) : API;
    const url = base + path;
    const r = await fetch(url, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    if(!r.ok){
      const t = await r.text().catch(()=> '');
      throw new Error(`HTTP ${r.status} ${r.statusText} @ ${url}\n${t.slice(0,200)}`);
    }
    let j; try{ j = await r.json(); }catch{ j = {}; }
    if(j && j.ok===false) throw new Error(j.error||'API error');
    return j.data ?? j;
  }

  function normFlight(rec){
    return {
      id: String(rec.id ?? rec.ID ?? ''),
      flightNo: trimStr(rec.flight_no ?? rec.flightNo ?? ''),
      origin: trimStr(rec.origin),
      destination: trimStr(rec.destination),
      date: trimStr(rec.date),
      remainKg: +((rec.remain_kg ?? rec.remainKg) || 0),
      remainCbm: +((rec.remain_cbm ?? rec.remainCbm) || 0),
      prices: {
        economy: +(rec.price_economy ?? rec.economy ?? 0),
        express: +(rec.price_express ?? rec.express ?? 0),
        priority: +(rec.price_priority ?? rec.priority ?? 0)
      }
    };
  }

  /* ---------- units & conversion ---------- */
  function currentUnits(){ return document.querySelector('input[name="units"]:checked')?.value || 'metric'; }
  const toKg = lb => lb * 0.45359237;
  const toCm = inch => inch * 2.54;

  /** Return unrounded cw for payload, rounded only for UI display */
  function collectPieces(){
    const isMetric = currentUnits()==='metric';
    const rows = $$('.piece');
    const pieces = [];
    let grossKg=0, volKg=0, cbm=0;

    rows.forEach(row=>{
      const L = parseFloat($('.len',row).value);
      const W = parseFloat($('.wid',row).value);
      const H = parseFloat($('.hei',row).value);
      const G = parseFloat($('.wei',row).value);
      const Q = parseInt($('.qty',row).value||'1',10);

      const lcm = isMetric ? L : toCm(L);
      const wcm = isMetric ? W : toCm(W);
      const hcm = isMetric ? H : toCm(H);
      const gkg = isMetric ? G : toKg(G);

      grossKg += (gkg||0) * (Q||0);
      volKg   += ((lcm||0)*(wcm||0)*(hcm||0)/6000) * (Q||0);
      cbm     += ((lcm||0)*(wcm||0)*(hcm||0)/1e6) * (Q||0);

      pieces.push({Lcm: +(lcm||0).toFixed(1), Wcm: +(wcm||0).toFixed(1), Hcm: +(hcm||0).toFixed(1), Gkg: +(gkg||0).toFixed(2), Q: Q||0});
    });

    const cwRaw = Math.max(grossKg, volKg);               // <-- unrounded
    return {pieces, cw: cwRaw, cbm:+cbm.toFixed(3), grossKg:+grossKg.toFixed(3), volKg:+volKg.toFixed(3)};
  }

  /* ---------- DOM ---------- */
  const fromSel  = document.getElementById('fromCity');
  const toSel    = document.getElementById('toCity');
  const dirChips = document.querySelectorAll('[data-direction]');
  const serviceSel = document.getElementById('service');
  const readyDate  = document.getElementById('readyDate');
  const prefFlight = document.getElementById('prefFlight');

  const sumCw    = document.getElementById('sumCw');
  const sumSvc   = document.getElementById('sumSvc');
  const sumLane  = document.getElementById('sumLane');
  const sumPrice = document.getElementById('sumPrice');

  function setOptions(select, list, selected){
    if(!select) return;
    select.innerHTML = '';
    if(list.length===0){
      const opt = document.createElement('option');
      opt.value=''; opt.textContent='—'; select.appendChild(opt);
      return;
    }
    list.forEach(v=>{
      const opt = document.createElement('option');
      opt.value = v; opt.textContent = v;
      select.appendChild(opt);
    });
    if(selected){ select.value = selected; }
  }

  /* ---------- flight lists / airports ---------- */
  let FLIGHTS = [];
  let DESTS_FROM_KWI = [];
  let ORIGINS_TO_KWI = [];
  let direction = 'export';

  async function loadFlights(){
    const raw = await apiGet('/flights.php');
    FLIGHTS = (raw||[]).map(normFlight);
    const destSet = new Set( FLIGHTS.filter(f=> isKuwait(f.origin)).map(f=> f.destination) );
    const origSet = new Set( FLIGHTS.filter(f=> isKuwait(f.destination)).map(f=> f.origin) );
    DESTS_FROM_KWI = Array.from(destSet).sort(byAlpha);
    ORIGINS_TO_KWI = Array.from(origSet).sort(byAlpha);
  }
  function applyDirection(){
    if(direction==='export'){
      setOptions(fromSel, ['Kuwait'], 'Kuwait'); fromSel.disabled = true;
      setOptions(toSel, DESTS_FROM_KWI, DESTS_FROM_KWI[0]||''); toSel.disabled = false;
    }else{
      setOptions(toSel, ['Kuwait'], 'Kuwait'); toSel.disabled = true;
      setOptions(fromSel, ORIGINS_TO_KWI, ORIGINS_TO_KWI[0]||''); fromSel.disabled = false;
    }
    updateLane();
  }
  function currentRoute(){
    const origin = direction==='export' ? 'Kuwait' : (fromSel.value||'');
    const destination = direction==='export' ? (toSel.value||'') : 'Kuwait';
    return { origin, destination, label: `${origin} \u2192 ${destination}` };
  }
  function updateLane(){ sumLane.textContent = currentRoute().label; }

  dirChips.forEach(ch=>{
    ch.addEventListener('click', ()=>{
      dirChips.forEach(x=>{ x.classList.remove('is-active'); x.setAttribute('aria-pressed','false'); });
      ch.classList.add('is-active'); ch.setAttribute('aria-pressed','true');
      direction = ch.dataset.direction;
      applyDirection();
      clearPriceNote();
    });
  });
  fromSel?.addEventListener('change', ()=>{ updateLane(); clearPriceNote(); });
  toSel?.addEventListener('change',   ()=>{ updateLane(); clearPriceNote(); });
  serviceSel?.addEventListener('change', ()=>{ sumSvc.textContent = serviceSel.value; clearPriceNote(); });

  /* ---------- pieces UI ---------- */
  (function piecesUi(){
    const piecesBox = document.querySelector('.pieces');
    const addBtn = document.getElementById('addPiece');
    const unitRadios = document.querySelectorAll('input[name="units"]');
    const unitNote = document.getElementById('unitNote');

    function relabelPieceRow(row){
      const isMetric = currentUnits()==='metric';
      row.querySelector('.len').placeholder = isMetric ? 'L (cm)' : 'L (in)';
      row.querySelector('.wid').placeholder = isMetric ? 'W (cm)' : 'W (in)';
      row.querySelector('.hei').placeholder = isMetric ? 'H (cm)' : 'H (in)';
      row.querySelector('.wei').placeholder = isMetric ? 'kg'    : 'lb';
    }
    function convertRowUnits(row, to){
      const isMetric = (to==='metric');
      const L = row.querySelector('.len'), W = row.querySelector('.wid'), H = row.querySelector('.hei'), G = row.querySelector('.wei');
      const conv = (x)=> (x==='' ? '' : parseFloat(x));
      let l = conv(L.value), w = conv(W.value), h = conv(H.value), g = conv(G.value);
      const toLb = kg=> kg / 0.45359237;
      const toIn = cm=> cm / 2.54;
      const toKgLocal = lb=> lb * 0.45359237;
      const toCmLocal = inch=> inch * 2.54;
      if(!Number.isNaN(l)){ L.value = (isMetric ? toCmLocal(l) : toIn(l)).toFixed(1); }
      if(!Number.isNaN(w)){ W.value = (isMetric ? toCmLocal(w) : toIn(w)).toFixed(1); }
      if(!Number.isNaN(h)){ H.value = (isMetric ? toCmLocal(h) : toIn(h)).toFixed(1); }
      if(!Number.isNaN(g)){ G.value = (isMetric ? toKgLocal(g) : toLb(g)).toFixed(2); }
    }
    function hookRow(row){
      row.addEventListener('input', computeCwOnly);
      row.querySelector('.kill').addEventListener('click', ()=>{
        if(document.querySelectorAll('.piece').length>1){
          row.remove(); computeCwOnly();
        }
      });
      relabelPieceRow(row);
    }
    addBtn?.addEventListener('click', ()=>{
      const row = document.createElement('div');
      row.className = 'piece';
      row.innerHTML = `
        <label class="field">Length <input type="number" min="0" step="0.1" class="len" placeholder="L" required></label>
        <label class="field">Width <input type="number" min="0" step="0.1" class="wid" placeholder="W" required></label>
        <label class="field">Height <input type="number" min="0" step="0.1" class="hei" placeholder="H" required></label>
        <label class="field">Weight <input type="number" min="0" step="0.1" class="wei" placeholder="kg" required></label>
        <label class="field">Qty <input type="number" min="1" step="1" class="qty" value="1" required></label>
        <button type="button" class="kill" aria-label="Remove piece" title="Remove piece">Remove</button>
      `;
      piecesBox.querySelector('.calc').insertBefore(row, addBtn);
      hookRow(row);
    });
    document.querySelectorAll('.piece').forEach(hookRow);
    unitRadios.forEach(r=>{
      r.addEventListener('change', ()=>{
        const newU = currentUnits();
        unitNote.innerHTML = newU==='metric'
          ? 'Dimensions in <strong>cm</strong>, weight in <strong>kg</strong>. Volumetric divisor: <strong>6000</strong>.'
          : 'Dimensions in <strong>in</strong>, weight in <strong>lb</strong>. Volumetric divisor: <strong>366</strong>.';
        document.querySelectorAll('.piece').forEach(row=>{
          convertRowUnits(row, newU);
          relabelPieceRow(row);
        });
        computeCwOnly();
        clearPriceNote();
      });
    });
  })();

  function computeCwOnly(){
    const {cw} = collectPieces();
    sumCw.textContent = cw>0 ? `${cw.toFixed(1)} kg` : '—';
    if (!document.body.dataset.hasLivePrice) sumPrice.textContent = '—';
  }
  function clearPriceNote(){
    document.body.dataset.hasLivePrice = '';
    sumPrice.textContent = '—';
    const note = document.querySelector('.summary .muted');
    if(note) note.textContent = 'Live rate appears after quote. Ensure date/route match an available flight.';
  }

  /* ---------- DG toggle ---------- */
  (function(){
    const chips = document.querySelectorAll('[data-dg]');
    const box = document.getElementById('dgExtra');
    chips.forEach(c=>{
      c.addEventListener('click', ()=>{
        chips.forEach(x=>{ x.classList.remove('is-active'); x.setAttribute('aria-pressed','false'); });
        c.classList.add('is-active'); c.setAttribute('aria-pressed','true');
        box.style.display = (c.dataset.dg==='yes') ? 'grid' : 'none';
      });
    });
  })();

  /* ---------- validation helpers ---------- */
  function validateRequired(){
    const req = $$('#cargoForm [required]');
    let ok=true;
    req.forEach(el=>{
      if(el.value === '' || el.value == null){ ok=false; el.style.borderColor='#ef4444'; }
      else { el.style.borderColor=''; }
    });
    return ok;
  }
  function validatePiecesPositive(){
    let ok=true, firstBad=null;
    $$('.piece').forEach(row=>{
      const L=$('.len',row), W=$('.wid',row), H=$('.hei',row), G=$('.wei',row), Q=$('.qty',row);
      const vals = [
        [L, parseFloat(L.value)],
        [W, parseFloat(W.value)],
        [H, parseFloat(H.value)],
        [G, parseFloat(G.value)],
        [Q, parseInt(Q.value,10)]
      ];
      vals.forEach(([el,val],i)=>{
        const good = i===4 ? (val>=1) : (val>0);
        if(!good){
          ok=false; if(!firstBad) firstBad=el;
          el.style.borderColor='#ef4444';
        }else{
          el.style.borderColor='';
        }
      });
    });
    if(!ok && firstBad){ firstBad.focus(); }
    return ok;
  }
  function parsePrefFlight(raw){
    const txt = (raw||'').trim();
    const no  = (txt.match(/(EA\d{2,4})/i)||[])[1] || null;
    const dt  = (txt.match(/\d{4}-\d{2}-\d{2}/)||[])[0] || null;
    return {no, dateISO: dt};
  }

  /* ---------- quote picking ---------- */
  function pickFlight(list, {readyISO, cw, prefNo, prefDateISO}){
    if(prefNo){
      const cand = list.find(f=>{
        const byNo = (f.flightNo||'').toLowerCase() === prefNo.toLowerCase();
        const byDt = prefDateISO ? (f.date===prefDateISO) : true;
        return byNo && byDt && (+f.remainKg||0) >= cw;
      });
      if(cand) return {flight:cand, reason:'preferred'};
    }
    const sameDay = list.find(f=> f.date===readyISO && (+f.remainKg||0)>=cw);
    if(sameDay) return {flight:sameDay, reason:'same-day'};
    const anyThatDay = list.filter(f=> f.date===readyISO);
    if(anyThatDay.length){
      return {flight:null, reason:'insufficient', capacity: anyThatDay.reduce((a,b)=> a + (+b.remainKg||0), 0)};
    }
    return {flight:null, reason:'no-flight-today'};
  }

  let FLIGHTS_CACHE = false;
  async function ensureFlights(){
    if(FLIGHTS_CACHE) return FLIGHTS;
    await loadFlights();
    applyDirection();
    FLIGHTS_CACHE = true;
    return FLIGHTS;
  }

  /* ---------- Quote ---------- */
  let PICKED = null;

  async function doQuote({silent=false}={}){
    if(!validateRequired() || !validatePiecesPositive()){
      if(!silent) alert('Please complete all piece dimensions, weight (>0) and form fields.');
      return null;
    }
    const {pieces, cw, cbm} = collectPieces();
    if(cw<=0){
      if(!silent) alert('Chargeable weight calculated as 0. Please check dimensions/weight.');
      return null;
    }

    const service  = document.getElementById('service').value;
    const readyISO = inputDateISO(document.getElementById('readyDate'));
    const {no:prefNo, dateISO:prefDateISO} = parsePrefFlight(document.getElementById('prefFlight').value);

    const {origin, destination, label} = currentRoute();
    sumLane.textContent = label;
    sumSvc.textContent  = service;
    sumCw.textContent   = `${cw.toFixed(1)} kg`;

    const flights = (await ensureFlights()).filter(f=> f.origin===origin && f.destination===destination);
    const pick = pickFlight(flights, {readyISO, cw, prefNo, prefDateISO});

    if(!pick.flight){
  PICKED = null; 
  document.body.dataset.hasLivePrice = ''; 
  sumPrice.textContent = '—';
  const note = document.querySelector('.summary .muted');
  if(pick.reason==='no-flight-today'){
    if(!silent) alert(`There is no flight on the selected date (${readyISO}) for this route.`);
    if(note) note.textContent = `No flight on ${readyISO} for ${label}. Choose another date.`;
  }else if(pick.reason==='insufficient'){
    if(!silent) alert(`On the selected date (${readyISO}), there is insufficient capacity. Available today: ${pick.capacity.toFixed(1)} kg. Please reduce the weight or choose another date.`);
    if(note) note.textContent = `Insufficient capacity on ${readyISO}. Reduce weight or choose another date.`;
  }
  return null;
}



    const f = pick.flight;
    const rate = +f.prices?.[service] || 0;
    const price = cw * rate;

    sumPrice.textContent = fmtKWD(price);
    document.body.dataset.hasLivePrice = '1';
    const note = document.querySelector('.summary .muted');
    if(note) note.textContent = `Live rate from flight ${f.flightNo} • ${f.date} • ${origin} → ${destination}`;

    PICKED = { flight: f, cw, cbm, rate, price, service, pieces, readyISO, routeLabel: label };
    return PICKED;
  }

  document.getElementById('getQuote')?.addEventListener('click', async ()=>{
    try{ await doQuote({silent:false}); }catch(e){ alert(e.message); }
  });

  /* ---------- Booking submit ---------- */
  document.getElementById('cargoForm')?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    try{
      if(!PICKED){ const ctx = await doQuote({silent:true}); if(!ctx) return; }
      if(PICKED.cw<=0){ alert('Chargeable weight is zero. Please correct your pieces.'); return; }

      const f = PICKED.flight;
      const payload = {
        route: PICKED.routeLabel,
        service: PICKED.service,
        cw: +PICKED.cw.toFixed(3),
        cbm: +PICKED.cbm.toFixed(3),
        rate: +PICKED.rate,
        shipper: document.getElementById('shipper').value.trim(),
        consignee: document.getElementById('consignee').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        notes: document.getElementById('notes').value.trim(),
        flightNo: f.flightNo,
        date: f.date,
        pieces: PICKED.pieces
      };

      if(PICKED.readyISO !== f.date){ alert(`Booking allowed only if flight exists on ${PICKED.readyISO}. Picked ${f.date}.`); return; }
      if(PICKED.cw > (+f.remainKg||0)){ alert(`Not available: requested ${PICKED.cw.toFixed(1)} kg > ${(+f.remainKg||0).toFixed(1)} kg.`); return; }

      const created = await apiPost('/bookings.php', payload);
const awb = created?.awb || created?.data?.awb || '—';
const status = created?.status || 'Received';

// Show printable receipt
showReceipt({
  awb, status, ts: new Date(),
  route: PICKED.routeLabel,
  service: PICKED.service,
  flightNo: f.flightNo,
  date: f.date,
  rate: PICKED.rate,
  cw: PICKED.cw,
  cbm: PICKED.cbm,
  price: +(PICKED.cw * PICKED.rate).toFixed(2),
  shipper: document.getElementById('shipper').value.trim(),
  consignee: document.getElementById('consignee').value.trim(),
  email: document.getElementById('email').value.trim(),
  phone: document.getElementById('phone').value.trim(),
  notes: document.getElementById('notes').value.trim(),
  pieces: PICKED.pieces
});

// (Optional) Track tab autoload karna ho to rakh sakte ho)
try{ document.getElementById('tab-track')?.click(); await showTrackResult(awb); }catch{}


    }catch(err){
      alert('Booking failed: ' + err.message);
    }
  });

  /* ---------- Tracking ---------- */
  async function fetchByAwb(awb){
    try{
      const data = await apiGet('/bookings.php', {awb});
      if(Array.isArray(data)) return data[0] || null;
      return data || null;
    }catch(e){
      try{ return await apiGet('/track.php', {awb}); } catch{ throw e; }
    }
  }
  async function showTrackResult(awb){
    const out = document.getElementById('trackResult'); out.style.display='block';
    out.innerHTML = `<div class="eyebrow">Tracking</div><div class="note">Loading…</div>`;
    try{
      const rec = await fetchByAwb(awb);
      if(!rec){ out.innerHTML = `<div class="eyebrow">Tracking</div><p>No record found for <strong>${awb}</strong>.</p>`; return; }
      const fno = rec.flight_no || rec.flightNo || '—';
      const fdt = rec.date || '—';
      const st  = rec.status || 'Received';
      const svc = (rec.service||'').toUpperCase();
      const cw  = ((+rec.cw) || 0).toFixed(1);
      const priceNum = +(rec.price_total ?? rec.priceTotal ?? (((+rec.cw)||0) * ((+rec.rate)||0)));
      const price = fmtKWD(priceNum);

      out.innerHTML = `
        <div class="eyebrow">Tracking result</div>
        <h4 style="margin:6px 0">AWB: ${rec.awb||awb}</h4>
        <ul>
          <li>Route: <strong>${rec.route||'—'}</strong></li>
          <li>Service: <strong>${svc}</strong></li>
          <li>Flight: <strong>${fno}</strong> • <strong>${fdt}</strong></li>
          <li>Chargeable: <strong>${cw} kg</strong> • Price: <strong>${price}</strong></li>
          <li>Status: <span class="pill">${st}</span></li>
        </ul>`;
    }catch(err){
      out.innerHTML = `<div class="eyebrow">Tracking</div><p class="note">Error: ${err.message}</p>`;
    }
  }
  document.getElementById('trackForm')?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const awb = document.getElementById('awb').value.trim();
    if(!awb){ alert('Enter AWB'); return; }
    await showTrackResult(awb);
  });

  /* ---------- Tabs behavior ---------- */
  (function tabs(){
    const tabs = ['book','track','rates'];
    tabs.forEach(id=>{
      const btn = document.getElementById('tab-'+id);
      const panel = document.getElementById('panel-'+id);
      btn?.addEventListener('click', ()=>{
        tabs.forEach(t=>{
          const b=document.getElementById('tab-'+t), p=document.getElementById('panel-'+t);
          b.setAttribute('aria-selected', String(t===id));
          if(t===id) p.removeAttribute('hidden'); else p.setAttribute('hidden','');
        });
      });
    });
  })();

  /* ---------- Mobile nav toggle (light) ---------- */
  (function navToggle(){
    const nav = document.querySelector('.nav');
    const toggle = document.getElementById('nav-toggle');
    const panel = document.getElementById('nav-panel');
    const backdrop = document.getElementById('nav-backdrop');
    function setOpen(open){
      nav.classList.toggle('open', open);
      toggle.setAttribute('aria-expanded', String(open));
      panel.hidden = !open; backdrop.hidden = !open;
    }
    toggle?.addEventListener('click', ()=> setOpen(!nav.classList.contains('open')));
    backdrop?.addEventListener('click', ()=> setOpen(false));
  })();

  /* ---------- INIT ---------- */
  (async function init(){
    try{
      setOptions(fromSel, ['Loading…'], 'Loading…');
      setOptions(toSel,   ['Loading…'], 'Loading…');
      await ensureFlights();
      applyDirection();
      sumSvc.textContent = document.getElementById('service')?.value || 'priority';
      clearPriceNote();
      computeCwOnly();
    }catch(e){
      alert('Initialization error: ' + e.message);
      setOptions(fromSel, ['Kuwait'],'Kuwait');
      setOptions(toSel, [], '');
    }
  })();

})();
</script>

<script src="assets/language-switcher.js" defer></script>
<!-- ===== Booking Receipt Modal ===== -->
<div id="receiptModal" class="rcpt-overlay" role="dialog" aria-modal="true" aria-labelledby="rcptTitle">
  <div class="rcpt">
    <header>
      <div class="brand">ELITE AIR — Cargo Booking Receipt</div>
      <div class="actions">
        <button class="btn" type="button" onclick="document.getElementById('receiptModal').classList.remove('show')">Close</button>
        <button class="btn primary" type="button" onclick="window.print()">Print</button>
      </div>
    </header>
    <div class="sheet" id="rcptBody">
      <!-- JS will inject receipt here -->
    </div>
  </div>
</div>

</body>
</html>
