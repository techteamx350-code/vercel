<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Elite Air — Review & Pay</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      /* brand & UI tokens */
      --gold:#C7A98C; --gold-hi:#FFD479; --ink:#111827; --muted:#6B7280; --line:#E5E7EB; --bg:#F7F6F3; --white:#ffffff;
      --shadow:0 10px 24px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);background:var(--bg);line-height:1.55}

    /* ===== Header (logo + Home + pax + language) ===== */
    .topbar{position:sticky;top:0;z-index:50;
      background:linear-gradient(90deg,#D5D7DB 0%,#C7A98C 44%,#F7F6F3 78%,#FDFDFC 100%);
      box-shadow:0 6px 24px rgba(0,0,0,.06), inset 0 -3px 0 rgba(184,146,106,.45)}
    .topbar-inner{max-width:1200px;margin:0 auto;padding:18px 20px;display:flex;align-items:center;gap:20px}
    .brand{font-family:"Playfair Display",serif;font-weight:700;font-size:22px;letter-spacing:.06em;color:#1e1e1e}
    .navlink{font-weight:700;text-decoration:none;color:#1e1e1e}
    .spacer{flex:1}
    .pill{border:1px solid var(--line);border-radius:999px;background:#fff;padding:8px 12px;font-weight:700;font-size:13px}
    .lang{position:relative}
    .langbtn{border:1px solid var(--line);border-radius:999px;background:#fff;padding:8px 12px;font-weight:800;cursor:pointer}
    .langlist{position:absolute;right:0;top:calc(100% + 8px);background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:0 12px 26px rgba(0,0,0,.08);list-style:none;margin:0;padding:6px;display:none}
    .langlist li{padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:700}
    .langlist li:hover{background:#f4f5f7}
    .lang.open .langlist{display:block}

    /* ===== Banner (route) ===== */
    .banner{background-image:linear-gradient(to bottom, rgba(255,255,255,.1), rgba(255,255,255,.75)),
                         url('https://eliteair.com.kw/demo/img/eliteair-service3.png');
            background-size:cover;background-position:center}
    .banner-inner{max-width:1200px;margin:0 auto;padding:26px 20px}
    .route{font-size:32px;font-weight:900;letter-spacing:.3px;}
    .route small{display:block;font-size:12px;color:var(--muted);margin-top:6px}

    /* ===== Stepper ===== */
    .steps{border-top:1px solid var(--line);border-bottom:1px solid var(--line);background:#fff}
    .steps-inner{max-width:1200px;margin:0 auto;padding:12px 20px;display:flex;gap:40px;align-items:center}
    .step{display:flex;align-items:center;gap:10px;color:var(--muted)}
    .num{width:28px;height:28px;border-radius:999px;display:grid;place-items:center;border:1px solid var(--line);background:#fff;font-weight:800}
    .active .num{background:linear-gradient(135deg,#C7A98C,#E7D9C7);color:#1e1e1e;border-color:transparent}
    .active{color:#111827}

    /* ===== Layout ===== */
    .wrap{max-width:1200px;margin:0 auto;padding:18px 20px}
    .layout{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
    @media (max-width:900px){.layout{grid-template-columns:1fr}}

    /* ===== Cards ===== */
    .card{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:14px}
    .section{padding:10px 0;border-top:1px dashed var(--line)}
    .section:first-child{border-top:none}
    .k{font-size:12px;color:var(--muted)}
    .list{display:grid;gap:8px}
    .row{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .row strong{font-weight:900}
    .chip{border:1px solid var(--line);border-radius:10px;padding:6px 10px;font-size:12px}
    .price{display:grid;gap:8px}
    .price .line{display:flex;justify-content:space-between}
    .price .total{border-top:1px solid var(--line);margin-top:8px;padding-top:8px;font-weight:900}
    .btn{appearance:none;border:0;border-radius:12px;padding:12px 14px;font-weight:800;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,#C7A98C,#E7D9C7);color:#111;width:100%}
    .btn.ghost{background:#fff;border:1px solid var(--line)}
    .terms{display:flex;gap:8px;align-items:flex-start}

    /* ===== Footer ===== */
    .elite-footer{position:relative;background:linear-gradient(180deg,#1C2128,#161A1F);color:#FDFDFC;padding:42px 20px 24px;overflow:hidden;margin-top:26px}
    .elite-mesh{position:absolute;inset:-10% -6% -18% -6%;transform:rotate(-6deg);width:120%;height:140%;pointer-events:none}
    .footer-inner{position:relative;z-index:1;max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:12px}
    .copy{color:#9FA6B2;font:500 14px/1.6 Inter,system-ui}
    .links{display:flex;gap:14px}
    .links a{color:#B9C1CC;text-decoration:none;font:600 14px/1.6 Inter,system-ui}
    .links a:hover{color:#FFD479}
  </style>
</head>
<body>

  <!-- ===== Header ===== -->
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="brand">ELITE&nbsp;AIR</div>
      <a class="navlink" href="../index.html">Home</a>
      <div class="spacer"></div>
      <span class="pill" id="paxSummary">1 Passenger</span>
      <div class="lang" id="lang">
        <button class="langbtn" id="langbtn" aria-haspopup="listbox" aria-expanded="false"><span id="curLang">EN</span> ▾</button>
        <ul class="langlist" id="langlist" role="listbox" aria-label="Choose language">
          <li role="option" data-lang="en">EN</li>
          <li role="option" data-lang="ar">AR</li>
          <li role="option" data-lang="fr">FR</li>
        </ul>
      </div>
    </div>
  </header>

  <!-- ===== Route Banner ===== -->
  <section class="banner">
    <div class="banner-inner">
      <div class="route" id="routeTitle">—</div>
      <small id="routeSub">—</small>
    </div>
  </section>

  <!-- ===== Stepper ===== -->
  <div class="steps"><div class="steps-inner">
    <div class="step"><span class="num">1</span> Choose flight</div>
    <div class="step"><span class="num">2</span> Personal details</div>
    <div class="step"><span class="num">3</span> Seat selection</div>
    <div class="step active"><span class="num">4</span> Review &amp; pay</div>
  </div></div>

  <!-- ===== Main ===== -->
  <div class="wrap">
    <div class="layout">
      <!-- LEFT: Review -->
      <div class="card">
        <div class="section">
          <h2 style="margin:0 0 6px">Itinerary</h2>
          <div class="k" id="tripSummary">—</div>
        </div>

        <div class="section" id="legsWrap" style="display:none">
          <h3 style="margin:0 0 6px">Flights</h3>
          <div id="leg0" class="list" style="margin-bottom:10px;display:none"></div>
          <div id="leg1" class="list" style="display:none"></div>
        </div>

        <div class="section">
          <h3 style="margin:0 0 6px">Passengers</h3>
          <div id="passengerList" class="list"></div>
          <div class="k" id="paxNote" style="margin-top:6px"></div>
        </div>

        <div class="section">
          <h3 style="margin:0 0 6px">Seats</h3>
          <div id="seatList" class="list"></div>
        </div>

        <div class="section">
          <h3 style="margin:0 0 6px">Fare &amp; rules</h3>
          <div class="row"><span>Outbound fare</span><span class="chip" id="fareChip0">—</span></div>
          <div class="row" id="fareRow1" style="display:none"><span>Return fare</span><span class="chip" id="fareChip1">—</span></div>
          <p class="k" style="margin:8px 0 0">No changes after departure. Name changes not permitted. Baggage allowance per fare rules.</p>
        </div>

        <div class="section">
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn ghost" id="backSeats">Back to seat selection</button>
            <button class="btn ghost" id="backDetails">Back to personal details</button>
            <button class="btn ghost" id="backChoose">Back to choose flight</button>
          </div>
        </div>

        <div class="section">
          <label class="terms"><input type="checkbox" id="accept"/> <span>I accept the fare conditions and privacy policy.</span></label>
        </div>
      </div>

      <!-- RIGHT: Price & Pay -->
      <aside class="card">
        <h2 style="margin:0 0 8px">Price summary</h2>
        <div class="price" id="priceBox"></div>
        <div style="margin-top:12px"><button class="btn primary" id="payBtn" disabled>Pay now</button></div>
        <div style="margin-top:10px;text-align:center" class="k">Secure checkout · AES‑256</div>
      </aside>
    </div>
  </div>

  <!-- ===== Footer ===== -->
  <footer class="elite-footer">
    <svg class="elite-mesh" viewBox="0 0 1600 900" preserveAspectRatio="none" aria-hidden="true">
      <defs>
        <linearGradient id="eaGold" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0" stop-color="#C7A98C"/><stop offset="1" stop-color="#FFD479"/>
        </linearGradient>
      </defs>
      <g stroke="url(#eaGold)" stroke-width="2.6" stroke-linecap="round" opacity="0.55">
        <path d="M-120,840 C 220,690 560,640 980,620 1310,605 1670,560 1880,490"/>
        <path d="M-120,760 C 220,620 560,580 980,560 1310,545 1670,510 1880,450"/>
        <path d="M-120,680 C 220,550 560,520 980,500 1310,490 1670,470 1880,415"/>
        <path d="M-120,600 C 220,480 560,460 980,440 1310,430 1670,440 1880,385"/>
        <path d="M-120,520 C 220,420 560,400 980,380 1310,370 1670,410 1880,360"/>
      </g>
      <g stroke="url(#eaGold)" stroke-width="2.6" stroke-linecap="round" opacity="0.55">
        <path d="M 0,900 C 360,760 720,700 1120,660 1520,620 1920,560 2320,520"/>
        <path d="M 0,820 C 360,700 720,640 1120,600 1520,560 1920,540 2320,500"/>
        <path d="M 0,740 C 360,640 720,600 1120,560 1520,520 1920,520 2320,480"/>
        <path d="M 0,660 C 360,580 720,560 1120,520 1520,500 1920,500 2320,460"/>
      </g>
    </svg>

    <div class="footer-inner">
      <div class="copy">© Elite Air</div>
      <div class="links">
        <a href="../privacy-policy.html">Privacy</a>
        <a href="../Terms-And-Conditions.html">Terms</a>
        <a href="../contact.html">Help</a>
      </div>
    </div>
  </footer>

  <script>
    /* Language dropdown */
    (function(){
      const wrap = document.getElementById('lang');
      const btn  = document.getElementById('langbtn');
      const list = document.getElementById('langlist');
      const cur  = document.getElementById('curLang');
      btn.addEventListener('click', ()=> {
        const open = wrap.classList.toggle('open');
        btn.setAttribute('aria-expanded', open?'true':'false');
      });
      document.addEventListener('click', (e)=>{ if(!wrap.contains(e.target)){ wrap.classList.remove('open'); btn.setAttribute('aria-expanded','false'); } });
      list.addEventListener('click', (e)=>{ const li=e.target.closest('li'); if(!li) return; cur.textContent=li.dataset.lang.toUpperCase(); wrap.classList.remove('open'); btn.setAttribute('aria-expanded','false'); document.documentElement.dir = (li.dataset.lang==='ar')?'rtl':'ltr'; });
    })();
  </script>

  <script> 
    /* ===== Review & Pay: reads all selections from query + sessionStorage; links both ways ===== */

    const qs = (s,el=document)=>el.querySelector(s);
    const qsa = (s,el=document)=>Array.from(el.querySelectorAll(s));

    const AIRPORTS = {
      KWI:{city:'Kuwait'}, LHR:{city:'London Heathrow'}, LGW:{city:'London Gatwick'},
      ORY:{city:'Paris Orly'}, RAK:{city:'Marrakesh'}, CAI:{city:'Cairo'},
      IST:{city:'Istanbul'}, DXB:{city:'Dubai'}, RUH:{city:'Riyadh'}, DOH:{city:'Doha'}, BAH:{city:'Bahrain'}, JED:{city:'Jeddah'}
    };
    function city(code){ return AIRPORTS[code]?.city || code; }
    function dstr(iso){ return new Date(iso).toLocaleDateString(undefined,{weekday:'short', day:'2-digit', month:'short', year:'numeric'}); }
    function fmt(amount,cur){
      const n = Number(amount||0);
      try{ return new Intl.NumberFormat(undefined,{style:'currency',currency:(cur||'KWD')}).format(n); }
      catch(e){ return `${cur||'KWD'} ${n.toFixed(2)}`; }
    }

    /* === NEW: Fare/package label helper === */
    const FARE_NAMES = { SR:'Serene', HR:'Harmony', MJ:'Majesty' };
    const fareLabel = (code) => code ? `${code} • ${FARE_NAMES[code] || ''}` : '—';

    function params(){
      const u = new URL(location.href);
      const p = Object.fromEntries(u.searchParams.entries());
      p.from = (p.from||'KWI').toUpperCase();
      p.to   = (p.to||'ORY').toUpperCase();
      p.trip = (p.trip==='oneway') ? 'oneway' : 'round';
      p.date = p.date || new Date(Date.now()+3*86400000).toISOString().slice(0,10);
      if(p.trip==='round'){ p.returnDate = p.returnDate || new Date(Date.parse(p.date)+3*86400000).toISOString().slice(0,10); }
      p.a = Math.max(1, Math.min(9, Number(p.a||1)));
      p.c = Math.max(0, Math.min(9, Number(p.c||0)));
      p.i = Math.max(0, Math.min(9, Number(p.i||0)));
      p.pax = Math.max(1, Math.min(9, Number(p.pax || (p.a+p.c+p.i))));
      p.cur = (p.cur||'KWD').toUpperCase();

      // Fares & prices (per passenger, from Choose-flight)
      if(p.fare0) p.fare0 = String(p.fare0).toUpperCase();
      if(p.fare1) p.fare1 = String(p.fare1).toUpperCase();
      p.price0 = Number(p.price0 || 0);
      p.price1 = Number(p.price1 || 0);

      // Seats and seat fees (from Seat selection)
      p.seatSel0 = (p.seatSel0||'').split(',').filter(Boolean);
      p.seatSel1 = (p.seatSel1||'').split(',').filter(Boolean);
      p.seatFeeKWD0 = Number(p.seatFeeKWD0 || 0);
      p.seatFeeKWD1 = Number(p.seatFeeKWD1 || 0);

      return p;
    }
    const P = params();

    function renderHeader(){
      qs('#paxSummary').textContent = `Adult ${P.a} · Child ${P.c} · Infant ${P.i}`;
      const isRT = (P.trip==='round' && P.returnDate);
      qs('#routeTitle').textContent = isRT ? `${P.from} → ${P.to} → ${P.from}` : `${P.from} → ${P.to}`;
      const seg1 = `${city(P.from)} to ${city(P.to)} on ${dstr(P.date)}`;
      const seg2 = isRT ? ` · Return ${city(P.to)} to ${city(P.from)} on ${dstr(P.returnDate)}` : '';
      qs('#routeSub').textContent = `${seg1}${seg2} · ${P.pax} passenger${P.pax>1?'s':''} • ${isRT?'Round trip':'One way'}`;
    }

    function renderLegs(){
      const isRT = (P.trip==='round' && P.returnDate);
      const wrap0 = qs('#leg0'); const wrap1 = qs('#leg1');
      qs('#legsWrap').style.display = 'block';

      wrap0.style.display = 'grid';
      wrap0.innerHTML = `
        <div class="row"><strong>Departure</strong><span>${P.from} → ${P.to}</span></div>
        <div class="row"><span class="k">Date</span><span>${dstr(P.date)}</span></div>
      `;
      if(isRT){
        if(qs('#fareRow1')) qs('#fareRow1').style.display = 'flex';
        wrap1.style.display = 'grid';
        wrap1.innerHTML = `
          <div class="row"><strong>Return</strong><span>${P.to} → ${P.from}</span></div>
          <div class="row"><span class="k">Date</span><span>${dstr(P.returnDate)}</span></div>
        `;
      }
      // Fare chips (UPDATED: show code + package name)
      if(qs('#fareChip0')) qs('#fareChip0').textContent = fareLabel(P.fare0);
      if(isRT && qs('#fareChip1')) qs('#fareChip1').textContent = fareLabel(P.fare1);
    }

    function loadPassengersFromStorage(){
      // Stored by personal-details.html under 'ea:passengers'
      try{
        const raw = sessionStorage.getItem('ea:passengers');
        if(!raw) return [];
        const obj = JSON.parse(raw);
        const list = [];
        // Lead passenger
        const lead = {
          title: obj['title1'] || '',
          fn:    obj['fn1'] || '',
          ln:    obj['ln1'] || '',
          dob:   obj['dob1'] || '',
          nat:   obj['nat1'] || ''
        };
        list.push(lead);
        // Additional passengers (fn2/ln2, fn3/ln3, …)
        for(let i=2;i<=P.pax;i++){
          list.push({
            title: obj[`title${i}`] || '',
            fn:    obj[`fn${i}`] || '',
            ln:    obj[`ln${i}`] || '',
            dob:   obj[`dob${i}`] || '',
            nat:   obj[`nat${i}`] || ''
          });
        }
        return list;
      }catch(e){ return []; }
    }

    function renderPassengers(){
      const box = qs('#passengerList');
      const pax = loadPassengersFromStorage();
      box.innerHTML = '';
      if(pax.length){
        pax.forEach((p,idx)=>{
          const name = [p.title, p.fn, p.ln].filter(Boolean).join(' ').trim() || `Passenger ${idx+1}`;
          const meta = [p.nat, p.dob].filter(Boolean).join(' • ');
          const row = document.createElement('div');
          row.className='row';
          row.innerHTML = `<strong>${name}</strong><span class="k">${meta || ''}</span>`;
          box.appendChild(row);
        });
        qs('#paxNote').textContent = '';
      }else{
        // Fallback if user refreshed (no details in storage)
        for(let i=1;i<=P.pax;i++){
          const row = document.createElement('div');
          row.className='row';
          row.innerHTML = `<strong>Passenger ${i}</strong><span class="k"></span>`;
          box.appendChild(row);
        }
        qs('#paxNote').textContent = 'Tip: personal details were not found in this session — proceed or go back to add them.';
      }
    }

    function renderSeats(){
      const box = qs('#seatList');
      const isRT = (P.trip==='round' && P.returnDate);
      const lines = [];
      // If URL query didn’t carry seats (rare), try to read from sessionStorage using keys set by seat-selection
      function readLeg(leg){
        if((leg===0 && P.seatSel0.length) || (leg===1 && P.seatSel1.length)) return;
        // derive fallback key (same derivation as seat-selection)
        const bookingKey = `${P.from}-${P.to}-${P.date}-p${P.pax}`;
        try{
          const raw = sessionStorage.getItem(`ea:seats:${bookingKey}:leg${leg}`);
          if(!raw) return;
          const obj = JSON.parse(raw);
          if(leg===0){ P.seatSel0 = obj.seats||[]; P.seatFeeKWD0 = Number(obj.feeKWD||0);}
          else { P.seatSel1 = obj.seats||[]; P.seatFeeKWD1 = Number(obj.feeKWD||0); }
        }catch(e){}
      }
      readLeg(0); if(isRT) readLeg(1);

      lines.push(`<div class="row"><span>Departure seats</span><span>${P.seatSel0.length?P.seatSel0.join(', '):'—'}</span></div>`);
      if(isRT) lines.push(`<div class="row"><span>Return seats</span><span>${P.seatSel1.length?P.seatSel1.join(', '):'—'}</span></div>`);
      lines.push(`<div class="row"><span class="k">Seat selection fees</span><span class="k">${fmt(P.seatFeeKWD0 + (isRT?P.seatFeeKWD1:0), P.cur)}</span></div>`);
      box.innerHTML = lines.join('');
    }

    function renderPrices(){
      const isRT = (P.trip==='round' && P.returnDate);
      const priceBox = qs('#priceBox');

      const base0 = Number(P.price0||0) * P.pax;
      const base1 = isRT ? (Number(P.price1||0) * P.pax) : 0;
      const seats = Number(P.seatFeeKWD0||0) + (isRT ? Number(P.seatFeeKWD1||0) : 0);
      const subtotal = base0 + base1 + seats;

      priceBox.innerHTML = `
        <div class="line"><span>Outbound fare × ${P.pax}</span><span>${fmt(base0,P.cur)}</span></div>
        ${isRT ? `<div class="line"><span>Return fare × ${P.pax}</span><span>${fmt(base1,P.cur)}</span></div>` : ``}
        <div class="line"><span>Seat selection fees</span><span>${fmt(seats,P.cur)}</span></div>
        <div class="total line"><span>Total due</span><span id="totalDue">${fmt(subtotal,P.cur)}</span></div>
      `;

      return subtotal;
    }

    function persistOrder(total){
      // Save a compact order payload for the confirmation page to read (in addition to URL params)
      const passengers = loadPassengersFromStorage();
      const payload = {
        from:P.from,to:P.to,date:P.date,returnDate:P.returnDate||'',
        trip:P.trip,pax:P.pax,a:P.a,c:P.c,i:P.i,cur:P.cur,
        fare0:P.fare0||'',fare1:P.fare1||'',price0:P.price0||0,price1:P.price1||0,
        seatSel0:P.seatSel0, seatSel1:P.seatSel1,
        seatFeeKWD0:P.seatFeeKWD0, seatFeeKWD1:P.seatFeeKWD1,
        passengers, total
      };
      try{ sessionStorage.setItem('ea:order', JSON.stringify(payload)); }catch(e){}
    }

    function init(){
      renderHeader();
      renderLegs();
      renderPassengers();
      renderSeats();
      const total = renderPrices();
      persistOrder(total);
      setupNavButtons();
    }

    function setupNavButtons(){
      // Back: seat selection (return leg if RT else departure)
      qs('#backSeats').addEventListener('click', ()=>{
        const u = new URL('seat-selection.html', location.href);
        const sp = u.searchParams;
        sp.set('from', P.from); sp.set('to', P.to);
        sp.set('date', P.date);
        sp.set('trip', P.trip);
        if(P.trip==='round' && P.returnDate) sp.set('returnDate', P.returnDate);
        sp.set('a', P.a); sp.set('c', P.c); sp.set('i', P.i); sp.set('pax', P.pax);
        if(P.fare0) sp.set('fare0', P.fare0);
        if(P.price0) sp.set('price0', P.price0);
        if(P.fare1) sp.set('fare1', P.fare1);
        if(P.price1) sp.set('price1', P.price1);
        if(P.cur) sp.set('cur', P.cur);
        sp.set('leg', (P.trip==='round' ? '1' : '0')); // go to return seats if RT
        location.href = u.toString();
      });

      // Back: personal details
      qs('#backDetails').addEventListener('click', ()=>{
        const u = new URL('personal-details.html', location.href);
        const sp = u.searchParams;
        sp.set('from', P.from); sp.set('to', P.to);
        sp.set('date', P.date);
        sp.set('trip', P.trip);
        if(P.trip==='round' && P.returnDate) sp.set('returnDate', P.returnDate);
        sp.set('a', P.a); sp.set('c', P.c); sp.set('i', P.i); sp.set('pax', P.pax);
        if(P.fare0) sp.set('fare0', P.fare0);
        if(P.price0) sp.set('price0', P.price0);
        if(P.fare1) sp.set('fare1', P.fare1);
        if(P.price1) sp.set('price1', P.price1);
        if(P.cur) sp.set('cur', P.cur);
        location.href = u.toString();
      });

      // Back: choose flight
      qs('#backChoose').addEventListener('click', ()=>{
        const u = new URL('booking/Choose-flight.html', location.href);
        const sp = u.searchParams;
        sp.set('from', P.from); sp.set('to', P.to);
        sp.set('date', P.date);
        sp.set('trip', P.trip);
        if(P.trip==='round' && P.returnDate) sp.set('returnDate', P.returnDate);
        sp.set('a', P.a); sp.set('c', P.c); sp.set('i', P.i); sp.set('pax', P.pax);
        if(P.cur) sp.set('cur', P.cur);
        location.href = u.toString();
      });

      // Terms checkbox enables Pay
      const accept = qs('#accept'), payBtn = qs('#payBtn');
      accept.addEventListener('change', ()=>{ payBtn.disabled = !accept.checked; });

      // Pay now → confirmation.html (embed all params + total + booking ref)
      payBtn.addEventListener('click', ()=>{
        const total = document.getElementById('totalDue').textContent;
        // Generate simple booking reference
        const ref = 'EA' + Math.random().toString(36).slice(2,8).toUpperCase();
        const u = new URL('confirmation.html', location.href);
        const sp = u.searchParams;

        sp.set('from', P.from); sp.set('to', P.to);
        sp.set('date', P.date);
        sp.set('trip', P.trip);
        if(P.trip==='round' && P.returnDate) sp.set('returnDate', P.returnDate);
        sp.set('a', P.a); sp.set('c', P.c); sp.set('i', P.i); sp.set('pax', P.pax);
        if(P.fare0) sp.set('fare0', P.fare0);
        if(P.price0) sp.set('price0', P.price0);
        if(P.fare1) sp.set('fare1', P.fare1);
        if(P.price1) sp.set('price1', P.price1);
        sp.set('cur', P.cur);

        // Seats & totals
        sp.set('seatSel0', P.seatSel0.join(','));
        sp.set('seatFeeKWD0', String(P.seatFeeKWD0||0));
        if(P.trip==='round'){
          sp.set('seatSel1', P.seatSel1.join(','));
          sp.set('seatFeeKWD1', String(P.seatFeeKWD1||0));
        }
        sp.set('total', total.replace(/[^\d.,]/g,''));
        sp.set('ref', ref);

        // Keep a light receipt in sessionStorage
        try{
          sessionStorage.setItem('ea:receipt', JSON.stringify({ ref, total, cur:P.cur, when: new Date().toISOString() }));
        }catch(e){}

        location.href = `../lodingpage.html?redirect=${encodeURIComponent(u.toString())}&msg=${encodeURIComponent('Processing payment…')}`;
      });
    }

    init();
</script>

</body>
</html>
