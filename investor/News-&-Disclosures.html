<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elite Air — News & Disclosures</title>
<link rel="icon" type="image/x-icon" href="img/elite.ico">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{ --ea-charcoal:#161A1F; --ea-pearl:#FDFDFC; --ea-gold:#C7A98C; --ea-gold-hi:#FFD479; --ink:#111827; --muted:#6b7280; --panel:#ffffff; --back:#f7f4ee; --radius:18px; --shadow:0 18px 60px rgba(15,23,42,.12); --nav-h:72px; --line:#e6e8ee; }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;color:var(--ink);background:var(--back);line-height:1.6;padding-top:calc(var(--nav-h)+18px)}
  .container{max-width:1200px;margin:0 auto;padding:0 20px}

  /* HEADER */
  .nav{position:fixed;top:0;left:0;right:0;z-index:10000;display:flex;align-items:center;gap:18px;padding:26px 56px; background:linear-gradient(90deg,#D5D7DB 0%,#C7A98C 44%,#F7F6F3 78%,#FDFDFC 100%); box-shadow:0 6px 24px rgba(0,0,0,.06), inset 0 -3px 0 rgba(184,146,106,.45)}
  .logo{font-family:"Playfair Display",serif;font-size:28px;font-weight:600;color:#1e1e1e;letter-spacing:.06em}
  .nav-links{display:flex;gap:40px;flex-wrap:wrap}
  .nav a{color:#222;text-decoration:none;font-weight:600;position:relative}
  .nav a::after{content:"";position:absolute;left:0;right:0;bottom:-4px;height:2px;background:#c7a98c;opacity:0;transform:scaleX(.6);transition:.2s}
  .nav a:hover{color:#c7a98c}
  .nav a:hover::after{opacity:1;transform:scaleX(1)}
  .spacer{flex:1}
  .btn-book{padding:12px 20px;border-radius:999px;border:1px solid #c7a98c;background:#fff;color:#1e1e1e;box-shadow:0 4px 14px rgba(0,0,0,.05);text-decoration:none}
  .btn-book:hover{background:#c7a98c;color:#fff}
  @media(max-width:960px){:root{--nav-h:64px}body{padding-top:calc(var(--nav-h)+12px)}.nav{padding:12px 16px}.nav-links{display:none}.btn-book{display:none}}

  /* HERO */
  .hero{background:#fff;border-bottom:1px solid var(--line)}
  .hero-inner{padding:22px 0}
  .hero h1{margin:.2rem 0;font-weight:800;font-size:clamp(28px,3.5vw,40px)}
  .hero p{margin:.4rem 0 0;color:#46546b}
  .pill{display:inline-block;padding:4px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#6b7280;font-size:12px}

  /* CONTENT */
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:18px;margin:18px 0 36px}
  @media(max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:18px;box-shadow:0 10px 24px rgba(15,23,42,.06);margin-bottom:18px}
  .card h2{margin:0 0 10px;font-weight:800;font-size:20px}
  .muted{color:#6b7280}
  .list{margin:0;padding-left:18px;color:#374151}
  .list li{margin:6px 0}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;font-weight:700;text-decoration:none;color:#111;cursor:pointer}
  .btn.gold{border-color:#d8c3a9;background:linear-gradient(90deg,#fdfbf7,#fff);box-shadow:0 8px 24px rgba(199,169,140,.18)}
  .table{width:100%;background:#fff;border:1px solid var(--line);border-radius:16px;overflow:hidden}
  .table table{width:100%;border-collapse:separate;border-spacing:0}
  .table th,.table td{padding:12px 14px;border-bottom:1px solid var(--line);text-align:left;font-size:14px;vertical-align:top}
  .table th{background:#fafafa;font-weight:800}
  .table tr:last-child td{border-bottom:0}
  input,select{padding:10px 12px;border:1px solid var(--line);border-radius:10px;font-family:inherit}
  .small{font-size:12px;color:#6b7280}
  .rtl{direction:rtl}
  .badge{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--line);background:#fff;white-space:nowrap}
  .ok{background:#f0fdf4;border-color:#bfe8c7}
  .warn{background:#fff7ed;border-color:#fbd2a8}
  .neg{background:#fee2e2;border-color:#fecaca}
  .tags{display:flex;gap:6px;flex-wrap:wrap}
  .tag{font-size:11px;border:1px solid var(--line);padding:2px 8px;border-radius:999px;background:#fff}
  .pager{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:10px}

/* Hide the "Need to edit?" card in the sidebar */
#editHead,
#editHead + p,
#editHead,
#editHead ~ * {
  display: none !important;
}

</style>
</head>
<body>

<!-- HEADER -->
<nav class="nav">
  <div class="logo">ELITE&nbsp;AIR</div>
  <div class="nav-links">
    <a href="../index.html">Home</a>
    <a href="../destinations.html">Destinations</a>
    <a href="../offers.html">Offers</a>
    <a href="../experience.html">Experience</a>
    <a href="../news.html">Latest news</a>
    <a href="../cargo.html">Cargo</a>
    <a href="../membership.html">Membership</a>
  </div>
  <div class="spacer"></div>
 <button class="btn-book" type="button" onclick="location.href='../members'">Members Login</button>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="container hero-inner">
    <h1>News & Disclosures <span class="pill" id="langTag">EN</span></h1>
  </div>
</section>

<div class="container">
  <div class="card" style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
    <div style="display:flex;gap:8px;align-items:center">
      <button class="btn" id="btnEN">EN</button>
      <button class="btn" id="btnAR">AR</button>
      <input id="q" placeholder="Search…"/>
      <select id="typeFilter"><option value="">All types</option><option>Press Release</option><option>Disclosure</option><option>Exchange Filing</option><option>Meeting</option><option>Other</option></select>
      <select id="yearFilter"><option value="">All years</option></select>
      <select id="tagFilter"><option value="">All tags</option></select>
      <select id="sort"><option value="date_desc">Newest first</option><option value="date_asc">Oldest first</option><option value="title_asc">Title A→Z</option><option value="title_desc">Title Z→A</option></select>
    </div>
    <div class="small">Last updated: <span id="updatedAt">—</span></div>
  </div>

  <div class="grid">
    <div>
      <!-- FEATURED -->
      <div class="card" id="featured" style="display:none">
        <h2 id="featHead">Featured</h2>
        <h3 id="featTitle" style="margin:6px 0">—</h3>
        <div class="muted small" id="featDate">—</div>
        <p id="featSum" style="margin-top:8px" class="muted"></p>
        <div class="tags" id="featTags"></div>
        <div style="margin-top:10px"><a class="btn gold" id="featLink" target="_blank" rel="noopener">Open</a></div>
      </div>

      <!-- TABLE -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
          <h2 style="margin:0" id="tblHead">All Items</h2>
          <div>
            <button class="btn gold" id="dlRSS">Download RSS</button>
            <button class="btn" id="dlJSON">Download JSON</button>
          </div>
        </div>
        <div class="table" style="margin-top:10px">
          <table>
            <thead><tr><th style="width:48%" id="thTitle">Title</th><th id="thType">Type</th><th id="thDate">Date</th><th>Link</th></tr></thead>
            <tbody id="rows"><tr><td colspan="4" class="muted">—</td></tr></tbody>
          </table>
        </div>
        <div class="pager">
          <button class="btn" id="prev">Prev</button>
          <span class="small" id="pageInfo">—</span>
          <button class="btn" id="next">Next</button>
        </div>
      </div>
    </div>

    <aside>
      <!-- REGULATORY CALENDAR (pulling from meetings if available) -->
      <div class="card">
        <h2 id="calHead">Regulatory Calendar</h2>
        <ul class="list" id="calList"></ul>
        <p class="small muted">For details, see <a href="Meetings-AGMEGM.html">Meetings (AGM/EGM)</a>.</p>
      </div>

      <div class="car">
        <h2 id="editHead">Need to edit?</h2>
        <p class="muted" id="editText">Open <a href="">Investors Admin → News</a> to add or update items, tags and featured highlight.</p>
      </div>
    </aside>
  </div>
</div>

<!-- CMS bootstrap snippet -->
<script>
  async function loadCMSFromServer(){
    try{
      const res = await fetch('/investor/api/news_get.php', { cache: 'no-store' });
      if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json();
      // Preserve meetings if already present in LS (calendar)
      const ls = window.EA_CMS || {};
      if (ls.meetings && !data.meetings) data.meetings = ls.meetings;
      window.EA_CMS = data;
      localStorage.setItem('EA_INVESTORS_CMS', JSON.stringify(data)); // offline fallback
    }catch(e){
      console.warn('Server fetch failed; using localStorage fallback:', e);
    }
  }
</script>


<script>
  const el = id=>document.getElementById(id);
  let lang='en';
  const PAGE_SIZE = 10; let page=1; let ITEMS=[]; let FILTERED=[];

  const L={
    en:{ news:'News & Disclosures', featured:'Featured', all:'All Items', title:'Title', type:'Type', date:'Date', editHead:'Need to edit?', editText:'Open Investors Admin → News to add or update items, tags and featured highlight.', cal:'Regulatory Calendar', rss:'Download RSS', json:'Download JSON' },
    ar:{ news:'الأخبار والإفصاحات', featured:'الأبرز', all:'جميع العناصر', title:'العنوان', type:'النوع', date:'التاريخ', editHead:'تحتاج تعديل؟', editText:'انتقل إلى لوحة الإدارة ← الأخبار لإضافة/تحديث العناصر والوسوم وبطاقة الأبرز.', cal:'الأجندة التنظيمية', rss:'تنزيل RSS', json:'تنزيل JSON' }
  };

  function parseDate(s){ if(!s) return null; const d=new Date(s); return isNaN(d)? null : d; }
  function yearOf(s){ const d=parseDate(s); return d? d.getFullYear().toString() : ''; }
  function fmtDate(s){ const d=parseDate(s); return d? d.toISOString().slice(0,10) : (s||'—'); }

  function buildFilters(){
    const years=new Set(); const tags=new Set();
    ITEMS.forEach(i=>{ const y=yearOf(i.date); if(y) years.add(y); (i.tags||[]).forEach(t=>tags.add(t)); });
    el('yearFilter').innerHTML = '<option value="">All years</option>' + [...years].sort((a,b)=>b.localeCompare(a)).map(y=>`<option>${y}</option>`).join('');
    el('tagFilter').innerHTML  = '<option value="">All tags</option>' + [...tags].sort().map(t=>`<option>${t}</option>`).join('');
  }

  function apply(){
    const q = el('q').value.trim().toLowerCase();
    const tf = el('typeFilter').value;
    const yf = el('yearFilter').value;
    const tg = el('tagFilter').value;
    const sort = el('sort').value;

    FILTERED = ITEMS.filter(i=>{
      const inQ = !q || `${i.title||''} ${i.summary||''}`.toLowerCase().includes(q);
      const inT = !tf || (i.type||'')===tf;
      const inY = !yf || yearOf(i.date)===yf;
      const inG = !tg || (i.tags||[]).includes(tg);
      return inQ && inT && inY && inG;
    });

    FILTERED.sort((a,b)=>{
      if(sort==='title_asc') return (a.title||'').localeCompare(b.title||'');
      if(sort==='title_desc') return (b.title||'').localeCompare(a.title||'');
      const da=parseDate(a.date); const db=parseDate(b.date);
      const na=da?da.getTime():-Infinity; const nb=db?db.getTime():-Infinity;
      return sort==='date_asc'? (na-nb) : (nb-na);
    });

    page=1; renderRows();
  }

  function renderRows(){
    const start=(page-1)*PAGE_SIZE; const slice=FILTERED.slice(start, start+PAGE_SIZE);
    el('rows').innerHTML = slice.length? slice.map(i=>`<tr>
      <td>
        <div><b>${i.title||'—'}</b></div>
        ${i.tags? `<div class='tags'>${(i.tags||[]).map(t=>`<span class='tag'>${t}</span>`).join('')}</div>`:''}
      </td>
      <td>${i.type||'—'}</td>
      <td>${fmtDate(i.date)}</td>
      <td>${i.url? `<a href='${i.url}' target='_blank' rel='noopener'>Open</a>`:'—'}</td>
    </tr>`).join('') : '<tr><td colspan="4" class="muted">No items match your filters.</td></tr>';

    const total = Math.max(1, Math.ceil(FILTERED.length / PAGE_SIZE));
    el('pageInfo').textContent = `Page ${page} / ${total}`;
    el('prev').disabled = page<=1; el('next').disabled = page>=total;
  }

  function renderFeatured(){
    const cms = window.EA_CMS || {}; const f = (cms.news && cms.news.featured) || null;
    const box = el('featured');
    if(!f){ box.style.display='none'; return; }
    box.style.display='block';
    el('featHead').textContent = (lang==='ar'? L.ar.featured : L.en.featured);
    el('featTitle').textContent = f.title || '—';
    el('featDate').textContent = fmtDate(f.date);
    el('featSum').textContent = f.summary || '';
    el('featTags').innerHTML = (f.tags||[]).map(t=>`<span class='tag'>${t}</span>`).join('');
    const a = el('featLink'); a.href = f.url||'#'; a.style.pointerEvents = f.url? 'auto':'none';
  }

  function toRSS(items){
    const site = location.origin || 'https://example.com';
    const now = new Date().toUTCString();
    const xml = [
      '<?xml version="1.0" encoding="UTF-8"?>',
      '<rss version="2.0"><channel>',
      `<title>Elite Air — News</title>`,
      `<link>${site}/news.html</link>`,
      `<description>Company news & disclosures</description>`,
      `<lastBuildDate>${now}</lastBuildDate>`,
      ...items.map(i=>[
        '<item>',
        `<title>${(i.title||'').replace(/&/g,'&amp;')}</title>`,
        i.url? `<link>${i.url}</link>`:'',
        i.date? `<pubDate>${new Date(i.date).toUTCString()}</pubDate>`:'',
        `<category>${i.type||''}</category>`,
        `<description>${(i.summary||'').replace(/&/g,'&amp;')}</description>`,
        '</item>'
      ].join('')),
      '</channel></rss>'
    ].join('');
    return new Blob([xml], {type:'application/rss+xml'});
  }

  function downloadRSS(){
    const blob = toRSS(ITEMS);
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='elite-air_news.xml'; a.click();
  }

  function downloadJSON(){
    const data = JSON.stringify(ITEMS, null, 2);
    const blob = new Blob([data], {type:'application/json'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='elite-air_news.json'; a.click();
  }

  function renderCalendar(){
    const cms = window.EA_CMS || {}; const m = (cms.meetings && cms.meetings.upcoming) || null;
    const list = el('calList');
    if(!m){ list.innerHTML = '<li class="muted">—</li>'; return; }
    list.innerHTML = [`<li><b>${m.title||'—'}</b><br><span class='small muted'>${fmtDate(m.date)} ${m.time? '• '+m.time: ''} ${m.venue? '• '+m.venue: ''}</span></li>`].join('');
  }

  function render(){
    const cms = window.EA_CMS || {};
    const n = cms.news || { items:[] };
    ITEMS = Array.isArray(n.items)? n.items.slice() : [];

    // language
    el('langTag').textContent = (lang==='ar'?'AR':'EN');
    if(lang==='ar'){ document.body.classList.add('rtl'); } else { document.body.classList.remove('rtl'); }
    const t = lang==='ar'? L.ar : L.en;
    document.title = `Elite Air — ${t.news}`;
    el('tblHead').textContent = t.all;
    el('thTitle').textContent = t.title;
    el('thType').textContent = t.type;
    el('thDate').textContent = t.date;
    el('calHead').textContent = t.cal;
    el('editHead').textContent = t.editHead; el('editText').textContent = t.editText;

    // meta
    el('updatedAt').textContent = (cms.meta && cms.meta.updatedAt) ? cms.meta.updatedAt : '—';

    // featured
    renderFeatured();

    // filters
    buildFilters();
    apply();

    // calendar
    renderCalendar();
  }

  window.addEventListener('DOMContentLoaded', async ()=>{
    const el = (id)=>document.getElementById(id);
    el('btnEN').addEventListener('click',()=>{lang='en'; render();});
    el('btnAR').addEventListener('click',()=>{lang='ar'; render();});
    ['q','typeFilter','yearFilter','tagFilter','sort'].forEach(id=> el(id).addEventListener('input', apply));
    el('prev').addEventListener('click', ()=>{ if(page>1){ page--; renderRows(); } });
    el('next').addEventListener('click', ()=>{ const total=Math.max(1, Math.ceil(FILTERED.length / PAGE_SIZE)); if(page<total){ page++; renderRows(); } });
    el('dlRSS').addEventListener('click', downloadRSS);
    el('dlJSON').addEventListener('click', downloadJSON);

    await loadCMSFromServer();  // ← MySQL → API
    render();                   // ← build UI
  });
</script>
</body>
</html>
