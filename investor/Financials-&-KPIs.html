<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elite Air — Financials & KPIs</title>
<link rel="icon" type="image/x-icon" href="img/elite.ico">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --ea-charcoal:#161A1F; --ea-pearl:#FDFDFC; --ea-gold:#C7A98C; --ea-gold-hi:#FFD479;
    --ink:#111827; --muted:#6b7280; --panel:#ffffff; --back:#f7f4ee;
    --radius:18px; --shadow:0 18px 60px rgba(15,23,42,.12); --nav-h:72px; --line:#e6e8ee;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;color:var(--ink);background:var(--back);line-height:1.6;padding-top:calc(var(--nav-h)+18px)}
  .container{max-width:1200px;margin:0 auto;padding:0 20px}

  /* HEADER */
  .nav{position:fixed;top:0;left:0;right:0;z-index:10000;display:flex;align-items:center;gap:18px;padding:26px 56px;
    background:linear-gradient(90deg,#D5D7DB 0%,#C7A98C 44%,#F7F6F3 78%,#FDFDFC 100%);box-shadow:0 6px 24px rgba(0,0,0,.06), inset 0 -3px 0 rgba(184,146,106,.45)}
  .logo{font-family:"Playfair Display",serif;font-size:28px;font-weight:600;color:#1e1e1e;letter-spacing:.06em}
  .nav-links{display:flex;gap:40px;flex-wrap:wrap}
  .nav a{color:#222;text-decoration:none;font-weight:600;position:relative}
  .nav a::after{content:"";position:absolute;left:0;right:0;bottom:-4px;height:2px;background:#c7a98c;opacity:0;transform:scaleX(.6);transition:.2s}
  .nav a:hover{color:#c7a98c}
  .nav a:hover::after{opacity:1;transform:scaleX(1)}
  .spacer{flex:1}
  .btn-book{padding:12px 20px;border-radius:999px;border:1px solid #c7a98c;background:#fff;color:#1e1e1e;box-shadow:0 4px 14px rgba(0,0,0,.05);text-decoration:none}
  .btn-book:hover{background:#c7a98c;color:#fff}
  @media(max-width:960px){:root{--nav-h:64px}body{padding-top:calc(var(--nav-h)+12px)}.nav{padding:12px 16px}.nav-links{display:none}.btn-book{display:none}}

  /* HERO */
  .hero{background:#fff;border-bottom:1px solid var(--line)}
  .hero-inner{padding:22px 0}
  .hero h1{margin:.2rem 0;font-weight:800;font-size:clamp(28px,3.5vw,40px)}
  .hero p{margin:.4rem 0 0;color:#46546b}
  .pill{display:inline-block;padding:4px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#6b7280;font-size:12px}

  /* CONTENT */
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:18px;margin:18px 0 36px}
  @media(max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:18px;box-shadow:0 10px 24px rgba(15,23,42,.06);margin-bottom:18px}
  .card h2{margin:0 0 10px;font-weight:800;font-size:20px}
  .muted{color:#6b7280}
  .list{margin:0;padding-left:18px;color:#374151}
  .list li{margin:6px 0}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;font-weight:700;text-decoration:none;color:#111;cursor:pointer}
  .btn.gold{border-color:#d8c3a9;background:linear-gradient(90deg,#fdfbf7,#fff);box-shadow:0 8px 24px rgba(199,169,140,.18)}
  .table{width:100%;background:#fff;border:1px solid var(--line);border-radius:16px;overflow:hidden}
  .table table{width:100%;border-collapse:separate;border-spacing:0}
  .table th,.table td{padding:12px 14px;border-bottom:1px solid var(--line);text-align:left;font-size:14px;vertical-align:top}
  .table th{background:#fafafa;font-weight:800}
  .table tr:last-child td{border-bottom:0}
  .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  @media(max-width:760px){.kpi{grid-template-columns:1fr}}
  .kpi .item{background:#fff;border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 10px 24px rgba(15,23,42,.06)}
  .kpi .label{font-size:12px;color:#6b7280}
  .kpi .value{font-size:22px;font-weight:800;margin-top:6px}
  .bar{height:10px;background:#f3f4f6;border-radius:999px;overflow:hidden;margin-top:10px}
  .bar > div{height:100%;background:linear-gradient(90deg,#d7bfa1,#fff0);width:0%}
  .small{font-size:12px;color:#6b7280}
</style>
</head>
<body>

<!-- HEADER -->
<nav class="nav">
  <div class="logo">ELITE&nbsp;AIR</div>
  <div class="nav-links">
    <a href="../index.html">Home</a>
    <a href="../destinations.html">Destinations</a>
    <a href="../offers.html">Offers</a>
    <a href="../experience.html">Experience</a>
    <a href="../news.html">Latest news</a>
    <a href="../cargo.html">Cargo</a>
    <a href="../membership.html">Membership</a>
  </div>
  <div class="spacer"></div>
  <button class="btn-book" type="button" onclick="location.href='../members'">Members Login</button>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="container hero-inner">
    <h1>Financials & KPIs</h1>
    
  </div>
</section>

<div class="container">
  <div class="grid">
    <div>
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
          <h2 style="margin:0">Revenue Breakdown</h2>
          <div class="small">Last updated: <span id="updatedAt">—</span></div>
        </div>
        <div class="kpi" id="revKPI"></div>
        <div class="bar"><div id="revBar"></div></div>
        <div class="table" style="margin-top:14px">
          <table>
            <thead><tr><th>Stream</th><th>Amount (KWD)</th></tr></thead>
            <tbody id="revRows"></tbody>
            <tfoot><tr><th>Total</th><th id="revTotal">—</th></tr></tfoot>
          </table>
        </div>
        <div style="margin-top:10px">
          <button class="btn gold" id="downloadCSV">Download CSV</button>
        </div>
      </div>

      <div class="card">
        <h2>Operating Metrics</h2>
        <ul class="list" id="oper"></ul>
      </div>

      <div class="card">
        <h2>Unit Metrics</h2>
        <ul class="list" id="unit"></ul>
      </div>

      <div class="card">
        <h2>Liquidity</h2>
        <ul class="list" id="liq"></ul>
      </div>
    </div>

    <aside>
      <div class="card">
        <h2>Notes</h2>
        <ul class="list">
          <li>Figures are inputs from Admin and may represent latest run-rate estimates.</li>
          <li>For methodology and reconciliations, see <a href="presentations-investors.html">Reports & Presentations</a>.</li>
        </ul>
      </div>
    </aside>
  </div>
</div>

<!-- CMS bootstrap snippet -->
<script>
  const CMS_KEY = 'EA_INVESTORS_CMS';
  function getCMS(){ try { return JSON.parse(localStorage.getItem(CMS_KEY) || '{}'); } catch(e){ return {}; } }
  window.EA_CMS = getCMS(); // fallback

  async function loadCMSFromServer(){
    try{
      // Path ko aapke server ke hisaab se set karein (same domain ho to relative chalega)
      const res = await fetch('/investor/api/financials_get.php', { cache: 'no-store' });
      if(!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();
      window.EA_CMS = data;                         // server data use
      localStorage.setItem(CMS_KEY, JSON.stringify(data)); // offline fallback ke liye cache
    }catch(err){
      console.warn('Server fetch failed, using localStorage fallback:', err);
    }
  }

  // (Agar aapko "cms=watch" storage event wali live preview chahiye, woh rehne do)
  const params = new URLSearchParams(location.search);
  if(params.get('cms')==='watch'){
    window.addEventListener('storage', (e)=>{ if(e.key===CMS_KEY) location.reload(); });
  }
</script>


<script>
  const el = id=>document.getElementById(id);
  const cleanNum = (s)=>{ if(s==null) return 0; const n = (''+s).replace(/[^0-9.\-]/g,''); const v = parseFloat(n); return isNaN(v)?0:v; };
  function fmt(n){ try{ return Number(n).toLocaleString('en-KW',{maximumFractionDigits:2}); }catch(e){ return n; } }

  function toCSV(rows){ return rows.map(r=>r.map(x=>`"${(x||'').toString().replace(/"/g,'""')}"`).join(',')).join('\n'); }

  function render(){
    const cms = window.EA_CMS || {};
    const d = cms.financials || { revenue:{}, operating:{}, unit:{}, liquidity:{} };

    // Last updated
    el('updatedAt').textContent = (cms.meta && cms.meta.updatedAt) ? cms.meta.updatedAt : '—';

    // Revenue
    const members = cleanNum(d.revenue?.members);
    const nonMembers = cleanNum(d.revenue?.nonMembers);
    const cargo = cleanNum(d.revenue?.cargo);
    const total = members + nonMembers + cargo;

    const revRows = [
      ['Memberships', members],
      ['Non-member Seats', nonMembers],
      ['Cargo', cargo]
    ];
    el('revRows').innerHTML = revRows.map(([k,v])=>`<tr><td>${k}</td><td>${fmt(v)}</td></tr>`).join('');
    el('revTotal').textContent = fmt(total);

    // KPI tiles
    el('revKPI').innerHTML = `
      <div class="item"><div class="label">Membership Revenue</div><div class="value">${fmt(members)} KWD</div></div>
      <div class="item"><div class="label">Non-member Revenue</div><div class="value">${fmt(nonMembers)} KWD</div></div>
      <div class="item"><div class="label">Cargo Revenue</div><div class="value">${fmt(cargo)} KWD</div></div>`;

    // Simple bar share (members vs others)
    const share = total ? Math.min(100, Math.max(0, Math.round((members/total)*100))) : 0;
    el('revBar').style.width = share + '%';
    el('revBar').title = `Members ${share}% of total`;

    // Operating
    const oper = [
      ['Fleet', d.operating?.fleet||'—'],
      ['Seats', d.operating?.seats||'—'],
      ['On-time Performance', d.operating?.onTime||'—'],
      ['Block Hours', d.operating?.blockHours||'—']
    ];
    el('oper').innerHTML = oper.map(([k,v])=>`<li><b>${k}:</b> ${v}</li>`).join('');

    // Unit
    const unit = [
      ['CASK', d.unit?.cask||'—'],
      ['RASK', d.unit?.rask||'—'],
      ['Breakeven LF', d.unit?.breakevenLF||'—']
    ];
    el('unit').innerHTML = unit.map(([k,v])=>`<li><b>${k}:</b> ${v}</li>`).join('');

    // Liquidity
    const liq = [
      ['Cash Runway', d.liquidity?.cashRunway||'—'],
      ['Lease Profile', d.liquidity?.leaseProfile||'—']
    ];
    el('liq').innerHTML = liq.map(([k,v])=>`<li><b>${k}:</b> ${v}</li>`).join('');

    // CSV download
    el('downloadCSV').onclick = ()=>{
      const rows = [['Stream','Amount (KWD)'], ...revRows, ['Total', total]];
      const csv = toCSV(rows);
      const blob = new Blob([csv], {type:'text/csv'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'elite-air_financials_revenue.csv';
      a.click();
    };
  }

  window.addEventListener('DOMContentLoaded', async () => {
  await loadCMSFromServer(); // pehle server se lao
  render();                  // phir UI build karo
});

</script>
</body>
</html>
