<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elite Air — Certificates & Legal</title>
<link rel="icon" type="image/x-icon" href="img/elite.ico">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --ea-charcoal:#161A1F; --ea-pearl:#FDFDFC; --ea-gold:#C7A98C; --ea-gold-hi:#FFD479;
    --ink:#111827; --muted:#6b7280; --panel:#ffffff; --back:#f7f4ee;
    --radius:18px; --shadow:0 18px 60px rgba(15,23,42,.12); --nav-h:72px; --line:#e6e8ee;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;color:var(--ink);background:var(--back);line-height:1.6;padding-top:calc(var(--nav-h)+18px)}
  .container{max-width:1200px;margin:0 auto;padding:0 20px}

  /* HEADER */
  .nav{position:fixed;top:0;left:0;right:0;z-index:10000;display:flex;align-items:center;gap:18px;padding:26px 56px;
    background:linear-gradient(90deg,#D5D7DB 0%,#C7A98C 44%,#F7F6F3 78%,#FDFDFC 100%);box-shadow:0 6px 24px rgba(0,0,0,.06), inset 0 -3px 0 rgba(184,146,106,.45)}
  .logo{font-family:"Playfair Display",serif;font-size:28px;font-weight:600;color:#1e1e1e;letter-spacing:.06em}
  .nav-links{display:flex;gap:40px;flex-wrap:wrap}
  .nav a{color:#222;text-decoration:none;font-weight:600;position:relative}
  .nav a::after{content:"";position:absolute;left:0;right:0;bottom:-4px;height:2px;background:#c7a98c;opacity:0;transform:scaleX(.6);transition:.2s}
  .nav a:hover{color:#c7a98c}
  .nav a:hover::after{opacity:1;transform:scaleX(1)}
  .spacer{flex:1}
  .btn-book{padding:12px 20px;border-radius:999px;border:1px solid #c7a98c;background:#fff;color:#1e1e1e;box-shadow:0 4px 14px rgba(0,0,0,.05);text-decoration:none}
  .btn-book:hover{background:#c7a98c;color:#fff}
  @media(max-width:960px){:root{--nav-h:64px}body{padding-top:calc(var(--nav-h)+12px)}.nav{padding:12px 16px}.nav-links{display:none}.btn-book{display:none}}

  /* HERO */
  .hero{background:#fff;border-bottom:1px solid var(--line)}
  .hero-inner{padding:22px 0}
  .hero h1{margin:.2rem 0;font-weight:800;font-size:clamp(28px,3.5vw,40px)}
  .hero p{margin:.4rem 0 0;color:#46546b}
  .pill{display:inline-block;padding:4px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#6b7280;font-size:12px}

  /* CONTENT */
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:18px;margin:18px 0 36px}
  @media(max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:18px;box-shadow:0 10px 24px rgba(15,23,42,.06);margin-bottom:18px}
  .card h2{margin:0 0 10px;font-weight:800;font-size:20px}
  .muted{color:#6b7280}
  .list{margin:0;padding-left:18px;color:#374151}
  .list li{margin:6px 0}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;font-weight:700;text-decoration:none;color:#111;cursor:pointer}
  .btn.gold{border-color:#d8c3a9;background:linear-gradient(90deg,#fdfbf7,#fff);box-shadow:0 8px 24px rgba(199,169,140,.18)}
  .table{width:100%;background:#fff;border:1px solid var(--line);border-radius:16px;overflow:hidden}
  .table table{width:100%;border-collapse:separate;border-spacing:0}
  .table th,.table td{padding:12px 14px;border-bottom:1px solid var(--line);text-align:left;font-size:14px;vertical-align:top}
  .table th{background:#fafafa;font-weight:800}
  .table tr:last-child td{border-bottom:0}
  .filters{display:flex;gap:10px;flex-wrap:wrap}
  input,select{padding:10px 12px;border:1px solid var(--line);border-radius:10px;font-family:inherit}
  .small{font-size:12px;color:#6b7280}
  .rtl{direction:rtl}
</style>
</head>
<body>

<!-- HEADER -->
<nav class="nav">
  <div class="logo">ELITE&nbsp;AIR</div>
  <div class="nav-links">
    <a href="../index.html">Home</a>
    <a href="../destinations.html">Destinations</a>
    <a href="../offers.html">Offers</a>
    <a href="../experience.html">Experience</a>
    <a href="../news.html">Latest news</a>
    <a href="../cargo.html">Cargo</a>
    <a href="../membership.html">Membership</a>
  </div>
  <div class="spacer"></div>
  <button class="btn-book" type="button" onclick="location.href='../members'">Members Login</button>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="container hero-inner">
    <h1>Certificates & Legal <span class="pill" id="langTag">EN</span></h1>
  </div>
</section>

<div class="container">
  <div class="card" style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
    <div style="display:flex;gap:8px;align-items:center">
      <button class="btn" id="btnEN">EN</button>
      <button class="btn" id="btnAR">AR</button>
    </div>
    <div class="small">Last updated: <span id="updatedAt">—</span></div>
  </div>

  <div class="grid">
    <div>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
          <h2 style="margin:0" id="idxHead">Document Index</h2>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="btn gold" id="downloadCSV">Download Index (CSV)</button>
          </div>
        </div>
        <div class="filters" style="margin:8px 0 12px">
          <input id="q" placeholder="Search title…"/>
          <select id="typeFilter">
            <option value="">All types</option>
            <option>Company</option>
            <option>Regulatory & Listing</option>
            <option>Safety/Industry</option>
            <option>Signatory Authority</option>
          </select>
          <select id="yearFilter"><option value="">All years</option></select>
          <select id="langFilter"><option value="">All languages</option><option>AR</option><option>EN</option></select>
          <select id="sort"><option value="date_desc">Newest first</option><option value="date_asc">Oldest first</option><option value="title_asc">Title A→Z</option><option value="title_desc">Title Z→A</option></select>
        </div>
        <div class="table">
          <table>
            <thead><tr><th style="width:48%" id="thTitle">Title</th><th id="thType">Type</th><th id="thEff">Effective</th><th id="thLang">Lang</th><th>Link</th></tr></thead>
            <tbody id="rows"><tr><td colspan="5" class="muted">Loading…</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <aside>
      <div class="card">
        <h2 id="noteHead">Notes</h2>
        <ul class="list" id="noteList"></ul>
      </div>
      <div class="card">
        <h2 id="legalHead">Legal</h2>
        <p class="muted" id="legalNote"></p>
      </div>
    </aside>
  </div>
</div>

<!-- CMS bootstrap snippet -->
<script>
  async function loadCMSFromServer(){
    try{
      const res = await fetch('/investor/api/certificates_get.php', { cache: 'no-store' });
      if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json();
      window.EA_CMS = data; // { meta.updatedAt, certificates:{company[],regulatory[],safety[],signatory[]} }
      localStorage.setItem('EA_INVESTORS_CMS', JSON.stringify(data)); // offline fallback
    }catch(err){
      console.warn('Server fetch failed; using localStorage fallback:', err);
    }
  }
</script>


<script>
  const el = id=>document.getElementById(id);
  let lang = 'en';

  const L = {
    en: {
      idxHead:'Document Index',
      notes:[
        'Arabic originals control; English versions are convenience translations.',
        'Mask personal data (civil IDs/signatures/addresses) on public copies.',
        'Use filenames with date + version (e.g., 2025-03-15_CR-Certificate_v1-AR.pdf).'
      ],
      legalHead:'Legal',
      legalNote:'The Arabic versions of official documents are the legally binding originals. English versions are provided for convenience only.',
      thTitle:'Title', thType:'Type', thEff:'Effective', thLang:'Lang',
    },
    ar: {
      idxHead:'فهرس الوثائق',
      notes:[
        'النسخ العربية هي النسخ القانونية المعتمدة، والإنجليزية للعلم فقط.',
        'إخفاء البيانات الشخصية (الرقم المدني/التواقيع/العناوين) في النسخ المنشورة.',
        'استخدم أسماء ملفات تشمل التاريخ والإصدار (مثال: 2025-03-15_CR-Certificate_v1-AR.pdf).'
      ],
      legalHead:'ملاحظة قانونية',
      legalNote:'تعد النسخ العربية للوثائق الرسمية النسخ القانونية الملزمة. النسخ الإنجليزية للتيسير فقط.',
      thTitle:'العنوان', thType:'النوع', thEff:'سريان', thLang:'اللغة',
    }
  };

  function parseDate(s){
    if (!s) return null;
    const d = new Date(s);
    return isNaN(d) ? null : d;
  }
  function yearOf(s){ const d=parseDate(s); return d? String(d.getFullYear()) : ''; }
  function fmtDate(s){ const d=parseDate(s); return d? d.toISOString().slice(0,10) : (s||'—'); }

  // Compile flat list from CMS buckets
  function compileDocs(c){
    const out=[];
    const push = (arr, type)=> (Array.isArray(arr)? arr:[]).forEach(x=> out.push({...x, type}));
    push(c.company, 'Company');
    push(c.regulatory, 'Regulatory & Listing');
    push(c.safety, 'Safety/Industry');
    push(c.signatory, 'Signatory Authority');
    return out;
  }

  let DOCS = [];

  function buildYearFilter(){
    const ys = new Set();
    DOCS.forEach(d=>{ const y = yearOf(d.effective); if(y) ys.add(y); });
    const sel = el('yearFilter');
    sel.innerHTML = '<option value="">All years</option>' + [...ys].sort((a,b)=>b.localeCompare(a)).map(y=>`<option>${y}</option>`).join('');
  }

  function render(){
    const cms = window.EA_CMS || {};
    const cert = cms.certificates || {company:[],regulatory:[],safety:[],signatory:[]};
    DOCS = compileDocs(cert);

    // Meta
    el('updatedAt').textContent = (cms.meta && cms.meta.updatedAt) ? cms.meta.updatedAt : '—';

    // Lang-dependent labels
    const t = L[lang];
    el('idxHead').textContent = t.idxHead;
    el('noteHead').textContent = (lang==='en' ? 'Notes' : 'ملاحظات');
    el('noteList').innerHTML = t.notes.map(x=>`<li>${x}</li>`).join('');
    el('legalHead').textContent = t.legalHead;
    el('legalNote').textContent = t.legalNote;
    el('thTitle').textContent = t.thTitle;
    el('thType').textContent = t.thType;
    el('thEff').textContent = t.thEff;
    el('thLang').textContent = t.thLang;

    el('langTag').textContent = (lang==='ar'?'AR':'EN');
    if (lang==='ar'){ document.body.classList.add('rtl'); } else { document.body.classList.remove('rtl'); }

    buildYearFilter();
    apply();
  }

  function apply(){
    const q = (el('q').value||'').trim().toLowerCase();
    const tf = el('typeFilter').value;
    const yf = el('yearFilter').value;
    const lf = (el('langFilter').value||'').toUpperCase();
    const sort = el('sort').value;

    let rows = DOCS.filter(d=>{
      const title = String(d.title||'').toLowerCase();
      const inQ = !q || title.includes(q);
      const inT = !tf || (d.type||'') === tf;
      const inY = !yf || yearOf(d.effective) === yf;
      const langVal = String(d.lang||'').toUpperCase();
      const inL = !lf || langVal === lf;
      return inQ && inT && inY && inL;
    });

    rows.sort((a,b)=>{
      if (sort==='title_asc') return (a.title||'').localeCompare(b.title||'');
      if (sort==='title_desc') return (b.title||'').localeCompare(a.title||'');
      const da = parseDate(a.effective); const db = parseDate(b.effective);
      const na = da? da.getTime(): -Infinity; const nb = db? db.getTime(): -Infinity;
      return (sort==='date_asc') ? (na-nb) : (nb-na);
    });

    el('rows').innerHTML = rows.length
      ? rows.map(d=>`<tr>
          <td>${d.title||'—'}</td>
          <td>${d.type||'—'}</td>
          <td>${fmtDate(d.effective)}</td>
          <td>${String(d.lang||'').toUpperCase()||'—'}</td>
          <td>${d.url? `<a href="${d.url}" target="_blank" rel="noopener">Open</a>` : '—'}</td>
        </tr>`).join('')
      : '<tr><td colspan="5" class="muted">No documents match your filters.</td></tr>';
  }

  function toCSV(rows){
    return rows.map(r=>r.map(x=>`"${(x||'').toString().replace(/"/g,'""')}"`).join(',')).join('\n');
  }

  function downloadCSV(){
    const rows = [['Title','Type','Effective','Lang','URL']]
      .concat(DOCS.map(d=>[
        d.title||'',
        d.type||'',
        fmtDate(d.effective),
        String(d.lang||'').toUpperCase(),
        d.url||''
      ]));
    const csv = toCSV(rows);
    const blob = new Blob([csv], {type:'text/csv'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'elite-air_certificates_index.csv'; a.click();
  }

  window.addEventListener('DOMContentLoaded', async ()=>{
  el('btnEN').addEventListener('click',()=>{lang='en'; render();});
  el('btnAR').addEventListener('click',()=>{lang='ar'; render();});
  ['q','typeFilter','yearFilter','langFilter','sort'].forEach(id=> el(id).addEventListener('input', apply));
  el('downloadCSV').addEventListener('click', downloadCSV);
  await loadCMSFromServer(); // ← MySQL → API
  render();                  // ← build UI
});
</script>
</body>
</html>
